var MauticVars={};var mQuery=jQuery.noConflict(true);window.jQuery=mQuery;mQuery(document).ready(function(){if(typeof mauticContent!=='undefined'){(function($){$("html").Core({console:false});})(mQuery);}
if(typeof Mousetrap!='undefined'){Mousetrap.bind('shift+d',function(e){mQuery('#mautic_dashboard_index').click();});Mousetrap.bind('shift+right',function(e){mQuery('.navbar-right > button.navbar-toggle').click();});}});MauticVars.manualStateChange=true;History.Adapter.bind(window,'statechange',function(){if(MauticVars.manualStateChange==true){window.location.reload();}
MauticVars.manualStateChange=true;});MauticVars.liveCache=new Array();MauticVars.lastSearchStr="";MauticVars.globalLivecache=new Array();MauticVars.lastGlobalSearchStr="";MauticVars.iconClasses={};MauticVars.routeInProgress='';mQuery.ajaxSetup({beforeSend:function(request,settings){if(settings.showLoadingBar){mQuery("body").addClass("loading-content");}},cache:false});if(typeof Chart!='undefined'){Chart.defaults.global.responsive=true;}
var Mautic={stopPageLoadingBar:function(){mQuery("body").removeClass("loading-content");},onPageLoad:function(container,response,inModal){mQuery(container+" a[data-toggle='ajax']").off('click.ajax');mQuery(container+" a[data-toggle='ajax']").on('click.ajax',function(event){event.preventDefault();return Mautic.ajaxifyLink(this,event);});mQuery(".sidebar-left a[data-toggle='ajax']").on('click.ajax',function(event){mQuery("html").removeClass('sidebar-open-ltr');});mQuery(container+" form[data-toggle='ajax']").each(function(index){Mautic.ajaxifyForm(mQuery(this).attr('name'));});mQuery(container+" *[data-toggle='ajaxmodal']").off('click.ajaxmodal');mQuery(container+" *[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Mautic.ajaxifyModal(this,event);});mQuery(container+" *[data-toggle='livesearch']").each(function(index){Mautic.activateLiveSearch(mQuery(this),"lastSearchStr","liveCache");});mQuery(container+" *[data-toggle='tooltip']").tooltip({html:true,container:'body'});mQuery(container+" *[data-toggle='sortablelist']").each(function(index){var prefix=mQuery(this).attr('data-prefix');if(mQuery('#'+prefix+'_additem').length){mQuery('#'+prefix+'_additem').click(function(){var count=mQuery('#'+prefix+'_itemcount').val();var prototype=mQuery('#'+prefix+'_additem').attr('data-prototype');prototype=prototype.replace(/__name__/g,count);mQuery(prototype).appendTo(mQuery('#'+prefix+'_list div.list-sortable'));mQuery('#'+prefix+'_list_'+count).focus();count++;mQuery('#'+prefix+'_itemcount').val(count);return false;});}
mQuery('#'+prefix+'_list div.list-sortable').sortable({items:'div.sortable',handle:'span.postaddon',stop:function(i){var order=0;mQuery('#'+prefix+'_list div.list-sortable div.input-group input').each(function(){var name=mQuery(this).attr('name');name=name.replace(/\[list\]\[(.+)\]$/g,'')+'[list]['+order+']';mQuery(this).attr('name',name);order++;});}});});mQuery(container+" a[data-toggle='download']").off('click.download');mQuery(container+" a[data-toggle='download']").on('click.download',function(event){event.preventDefault();var link=mQuery(event.target).attr('href');var iframe=mQuery("<iframe/>").attr({src:link,style:"visibility:hidden;display:none"}).appendTo(mQuery('body'));});mQuery(container+" a[data-toggle='confirmation']").off('click.confirmation');mQuery(container+" a[data-toggle='confirmation']").on('click.confirmation',function(event){event.preventDefault();MauticVars.ignoreIconSpin=true;return Mautic.showConfirmation(this);});mQuery(container+" *[data-toggle='modal']").each(function(index){var target=mQuery(this).attr('data-target');mQuery(target).off('show.bs.modal');mQuery(target).on('show.bs.modal',function(){if(!mQuery(target).hasClass('modal-moved')){mQuery(target).appendTo("body");mQuery(target).addClass('modal-moved');}});});mQuery(container+" *[data-toggle='datetime']").datetimepicker({format:'Y-m-d H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false});mQuery(container+" *[data-toggle='date']").datetimepicker({timepicker:false,format:'Y-m-d',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false,closeOnDateSelect:true});mQuery(container+" *[data-toggle='time']").datetimepicker({datepicker:false,format:'H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false});mQuery(container+" input[data-toggle='color']").pickAColor({fadeMenuToggle:false,inlineDropdown:true});mQuery("select[multiple]").chosen({placeholder_text_multiple:' '});mQuery(".chosen").chosen();mQuery(container+' .btn:not(.btn-nospin)').on('click.spinningicons',function(event){Mautic.startIconSpinOnEvent(event);});if(mQuery(container+" .bottom-form-buttons").length){if(inModal){if(mQuery(container+' .modal-form-buttons').length){mQuery(container+' .bottom-form-buttons').addClass('hide');var buttons=mQuery(container+" .bottom-form-buttons").html();mQuery(container+' .modal-form-buttons').html('');mQuery(buttons).filter("button").each(function(i,v){var id=mQuery(this).attr('id');var button=mQuery("<button type='button' />").addClass(mQuery(this).attr('class')).html(mQuery(this).html()).appendTo(container+' .modal-form-buttons').on('click.ajaxform',function(event){if(mQuery(this).hasClass('disabled')){return false;}
event.preventDefault();Mautic.startIconSpinOnEvent(event);mQuery('#'+id).click();});});}}else{mQuery('.toolbar-action-buttons').addClass('hide');if(mQuery('.toolbar-form-buttons').hasClass('hide')){mQuery(container+' .bottom-form-buttons').addClass('hide');var buttons=mQuery(container+" .bottom-form-buttons").html();mQuery(container+' .toolbar-form-buttons .hidden-xs').html('');mQuery(container+' .toolbar-form-buttons .hidden-md .drop-menu').html('');mQuery(buttons).filter("button").each(function(i,v){var id=mQuery(this).attr('id');var buttonClick=function(event){event.preventDefault();Mautic.startIconSpinOnEvent(event);mQuery('#'+id).click();};mQuery("<button type='button' />").addClass(mQuery(this).attr('class')).attr('id',mQuery(this).attr('id')+'_toolbar').html(mQuery(this).html()).on('click.ajaxform',buttonClick).appendTo('.toolbar-form-buttons .hidden-sm');if(i===0){mQuery(".toolbar-form-buttons .hidden-md .btn-main").off('.ajaxform').attr('id',mQuery(this).attr('id')+'_toolbar_mobile').html(mQuery(this).html()).on('click.ajaxform',buttonClick);}else{mQuery("<a />").attr('id',mQuery(this).attr('id')+'_toolbar_mobile').html(mQuery(this).html()).on('click.ajaxform',buttonClick).appendTo(mQuery('<li />').appendTo('.toolbar-form-buttons .hidden-md .dropdown-menu'))}});mQuery('.toolbar-form-buttons').removeClass('hide');}}}
mQuery.each(['editor','editor-advanced','editor-advanced-2rows','editor-fullpage'],function(index,editorClass){if(mQuery(container+' textarea.'+editorClass).length){mQuery(container+' textarea.'+editorClass).each(function(){var settings={};if(editorClass!='editor'){var toolbar=editorClass.replace('editor-','').replace('-','_');settings.toolbar=toolbar;}
if(editorClass=='editor-fullpage'){settings.fullPage=true;settings.extraPlugins="docprops";}
mQuery(this).ckeditor(settings);});}});var contentSpecific=false;if(response&&response.mauticContent){contentSpecific=response.mauticContent;}else if(container=='body'){contentSpecific=mauticContent;}
if(contentSpecific&&typeof Mautic[contentSpecific+"OnLoad"]=='function'){Mautic[contentSpecific+"OnLoad"](container,response);}
if(!inModal&&container=='body'){var engine=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace('value'),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mauticAjaxUrl+"?action=globalCommandList"}});engine.initialize();mQuery('#global_search').typeahead({hint:true,highlight:true,minLength:0,multiple:true},{name:"global_search",displayKey:'value',source:engine.ttAdapter()}).on('typeahead:selected',function(event,datum){MauticVars.lastGlobalSearchStr='';mQuery('#global_search').keyup();}).on('typeahead:autocompleted',function(event,datum){MauticVars.lastGlobalSearchStr='';mQuery('#global_search').keyup();}).on('keypress',function(event){if((event.keyCode||event.which)==13){mQuery('#global_search').typeahead('close');}});Mautic.activateLiveSearch("#global_search","lastGlobalSearchStr","globalLivecache");}
mQuery('.plugin-sparkline').sparkline('html',{enableTagOptions:true});Mautic.stopIconSpinPostEvent();Mautic.stopPageLoadingBar();},onPageUnload:function(container,response){if(typeof container!='undefined'){mQuery(container+" *[data-toggle='tooltip']").tooltip('destroy');mQuery(container+" *[data-toggle='modal']").each(function(index){var target=mQuery(this).attr('data-target');mQuery(target).remove();});mQuery(container+" *[data-toggle='ajaxmodal']").each(function(index){if(mQuery(this).attr('data-ignore-removemodal')!='true'){var target=mQuery(this).attr('data-target');mQuery(target).remove();}});mQuery.each(['editor','editor-advanced','editor-advanced-2rows','editor-fullpage'],function(index,editorClass){mQuery(container+' textarea.'+editorClass).each(function(){for(var name in CKEDITOR.instances){var instance=CKEDITOR.instances[name];if(this&&this==instance.element.$){instance.destroy(true);}}});});}
var contentSpecific=false;if(container=='#app-content'){contentSpecific=mauticContent;}else if(response&&response.mauticContent){contentSpecific=response.mauticContent;}
if(contentSpecific&&typeof Mautic[contentSpecific+"OnUnload"]=='function'){Mautic[contentSpecific+"OnUnload"](container,response);}},loadContent:function(route,link,method,target,showPageLoading){mQuery.ajax({showLoadingBar:(showPageLoading)?true:false,url:route,type:method,dataType:"json",success:function(response){if(response){if(target||response.target){if(target)response.target=target;Mautic.processPageContent(response);}else{MauticVars.liveCache=new Array();MauticVars.lastSearchStr='';if(typeof response.route==='undefined'){response.route=route;}
if(typeof response.activeLink==='undefined'&&link){response.activeLink=link;}
Mautic.processPageContent(response);}
Mautic.stopIconSpinPostEvent();}
MauticVars.routeInProgress='';},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);MauticVars.routeInProgress='';Mautic.stopIconSpinPostEvent();Mautic.stopPageLoadingBar();}});return false;},startIconSpinOnEvent:function(event){if(MauticVars.ignoreIconSpin){MauticVars.ignoreIconSpin=false;return;}
if(event&&typeof(event.target)!=='undefined'&&mQuery(event.target).length){var hasBtn=mQuery(event.target).hasClass('btn');var hasIcon=mQuery(event.target).hasClass('fa');var i=(hasBtn&&mQuery(event.target).find('i.fa').length)?mQuery(event.target).find('i.fa'):event.target;if((hasBtn&&mQuery(event.target).find('i.fa').length)||hasIcon){var el=(hasIcon)?event.target:mQuery(event.target).find('i.fa').first();var identifierClass=(new Date).getTime();MauticVars.iconClasses[identifierClass]=mQuery(el).attr('class');var specialClasses=['fa-fw','fa-lg','fa-2x','fa-3x','fa-4x','fa-5x','fa-li'];var appendClasses="";for(var i=0;i<specialClasses.length;i++){if(mQuery(el).hasClass(specialClasses[i])){appendClasses+=" "+specialClasses[i];}}
mQuery(el).removeClass();mQuery(el).addClass('fa fa-spinner fa-spin '+identifierClass+appendClasses);setTimeout(function(){Mautic.stopIconSpinPostEvent(identifierClass);},5000);}}},stopIconSpinPostEvent:function(specificId){if(typeof specificId!='undefined'&&specificId in MauticVars.iconClasses){mQuery('.'+specificId).removeClass('fa fa-spinner fa-spin '+specificId).addClass(MauticVars.iconClasses[specificId]);delete MauticVars.iconClasses[specificId];}else{mQuery.each(MauticVars.iconClasses,function(index,value){mQuery('.'+index).removeClass('fa fa-spinner fa-spin '+index).addClass(value);});MauticVars.iconClasses={};}},postForm:function(form,callback){var form=mQuery(form);var action=form.attr('action');if(action.indexOf("ajax=1")==-1){form.attr('action',action+((/\?/i.test(action))?"&ajax=1":"?ajax=1"));}
var showLoading=(form.attr('data-hide-loadingbar'))?false:true;form.ajaxSubmit({showLoadingBar:showLoading,success:function(data){MauticVars.formSubmitInProgress=false;callback(data);},error:function(request,textStatus,errorThrown){MauticVars.formSubmitInProgress=false;Mautic.processAjaxError(request,textStatus,errorThrown);}});},processPageContent:function(response){if(response){if(!response.target){response.target='#app-content';}
Mautic.onPageUnload(response.target,response);if(response.newContent){if(response.replaceContent&&response.replaceContent=='true'){mQuery(response.target).replaceWith(response.newContent);}else{mQuery(response.target).html(response.newContent);}}
if(response.route){MauticVars.manualStateChange=false;History.pushState(null,"Mautic",response.route);}
if(response.target=='#app-content'){if(response.mauticContent){mauticContent=response.mauticContent;}
window.setTimeout(function(){mQuery("#flashes .alert").fadeTo(500,0).slideUp(500,function(){mQuery(this).remove();});},7000);if(response.activeLink){var link=response.activeLink;if(link!==undefined&&link.charAt(0)!='#'){link="#"+link;}
var parent=mQuery(link).parent();mQuery(".nav-sidebar").find(".active").removeClass("active");parent.addClass("active");var openParent=parent.closest('li.open');mQuery(".nav-sidebar").find(".open").each(function(){if(!openParent.hasClass('open')||(openParent.hasClass('open')&&openParent[0]!==mQuery(this)[0])){mQuery(this).removeClass('open');}});}
mQuery('body').animate({scrollTop:0},0);}else{var overflow=mQuery(response.target).css('overflow');var overflowY=mQuery(response.target).css('overflowY');if(overflow=='auto'||overflow=='scroll'||overflowY=='auto'||overflowY=='scroll'){mQuery(response.target).animate({scrollTop:0},0);}}
if(response.overlayEnabled){mQuery(response.overlayTarget+' .content-overlay').remove();}
Mautic.onPageLoad(response.target,response);}},ajaxifyForm:function(formName){mQuery('form[name="'+formName+'"] input').off('keydown.ajaxform');mQuery('form[name="'+formName+'"] input').on('keydown.ajaxform',function(e){if(e.keyCode==13){var inputs=mQuery(this).parents("form").eq(0).find(":input");if(inputs[inputs.index(this)+1]!=null){inputs[inputs.index(this)+1].focus();}
e.preventDefault();return false;}});mQuery('form[name="'+formName+'"] :submit').each(function(){mQuery(this).off('click.ajaxform');mQuery(this).on('click.ajaxform',function(){if(mQuery(this).attr('name')&&!mQuery("input[name='"+mQuery(this).attr('name')+"']").length){mQuery('form[name="'+formName+'"]').append(mQuery("<input type='hidden'>").attr({name:mQuery(this).attr('name'),value:mQuery(this).attr('value')}));}});});mQuery('form[name="'+formName+'"]').off('submit.ajaxform');mQuery('form[name="'+formName+'"]').on('submit.ajaxform',(function(e){e.preventDefault();if(MauticVars.formSubmitInProgress){return false;}else{MauticVars.formSubmitInProgress=true;}
Mautic.postForm(mQuery(this),function(response){var modalParent=mQuery('form[name="'+formName+'"]').closest('.modal');var isInModal=modalParent.length>0?true:false;if(!isInModal){Mautic.processPageContent(response);}else{var target='#'+modalParent.attr('id');Mautic.processModalContent(response,target);}});return false;}));},ajaxifyLink:function(el,event){var route=mQuery(el).attr('href');if(route.indexOf('javascript')>=0||MauticVars.routeInProgress===route){return false;}
if(event.ctrlKey||event.metaKey){route=route.split("?")[0];window.open(route,'_blank');return;}
if(mQuery(".form-exit-unlock-id").length){if(mQuery(el).attr('data-ignore-formexit')!='true'){var unlockParameter=(mQuery('.form-exit-unlock-parameter').length)?mQuery('.form-exit-unlock-parameter').val():'';Mautic.unlockEntity(mQuery('.form-exit-unlock-model').val(),mQuery('.form-exit-unlock-id').val(),unlockParameter);}}
var link=mQuery(el).attr('data-menu-link');if(link!==undefined&&link.charAt(0)!='#'){link="#"+link;}
var method=mQuery(el).attr('data-method');if(!method){method='GET'}
MauticVars.routeInProgress=route;var target=mQuery(el).attr('data-target');if(!target){target=null;}
var showLoadingBar=(mQuery(el).attr('data-hide-loadingbar'))?false:true;Mautic.loadContent(route,link,method,target,showLoadingBar);},ajaxifyModal:function(el,event){var target=mQuery(el).attr('data-target');var route=mQuery(el).attr('href');if(route.indexOf('javascript')>=0){return false;}
var method=mQuery(el).attr('data-method');if(!method){method='GET'}
if(mQuery(target+' .loading-placeholder').length){mQuery(target+' .loading-placeholder').removeClass('hide');mQuery(target+' .modal-body-content').addClass('hide');}
var header=mQuery(el).attr('data-header');if(header){mQuery(target+" .modal-title").html(header);}
mQuery(target).on('show.bs.modal',function(){if(!mQuery(target).hasClass('modal-moved')){mQuery(target).appendTo('body');mQuery(target).addClass('modal-moved');}});mQuery(target).on('hide.bs.modal',function(){mQuery(target+" .modal-title").html('');mQuery(target+" .modal-body-content").html('');if(mQuery(target+" .modal-form-buttons").length){mQuery(target+" .modal-form-buttons").html('');}
if(mQuery(target+" loading-placeholder").length){mQuery(target+" loading-placeholder").removeClass('hide');}});mQuery(target).modal('show');mQuery.ajax({showLoadingBar:true,url:route,type:method,dataType:"json",success:function(response){if(response){Mautic.processModalContent(response,target);}
Mautic.stopIconSpinPostEvent();},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);Mautic.stopIconSpinPostEvent();}});},processModalContent:function(response,target){if(response.error){Mautic.stopIconSpinPostEvent();Mautic.stopPageLoadingBar();alert(response.error);return;}
if(response.closeModal&&response.newContent){mQuery(target).modal('hide');mQuery('.modal-backdrop').remove();Mautic.processPageContent(response);}else{if(response.closeModal){mQuery(target).modal('hide');Mautic.onPageUnload(target,response);if(response.mauticContent){if(typeof Mautic[response.mauticContent+"OnLoad"]=='function'){Mautic[response.mauticContent+"OnLoad"](target,response);}}}else{if(mQuery(target+' .loading-placeholder').length){mQuery(target+' .loading-placeholder').addClass('hide');mQuery(target+' .modal-body-content').html(response.newContent);mQuery(target+' .modal-body-content').removeClass('hide');}else{mQuery(target+' .modal-body').html(response.newContent);}
Mautic.onPageLoad(target,response,true);}}},showConfirmation:function(el){var message=mQuery(el).data('message');var confirmText=mQuery(el).data('confirm-text');var confirmAction=mQuery(el).attr('href');var confirmCallback=mQuery(el).data('confirm-callback');var cancelText=mQuery(el).data('cancel-text');var cancelCallback=mQuery(el).data('cancel-callback');var confirmContainer=mQuery("<div />").attr({"class":"modal fade confirmation-modal"});var confirmDialogDiv=mQuery("<div />").attr({"class":"modal-dialog"});var confirmContentDiv=mQuery("<div />").attr({"class":"modal-content confirmation-inner-wrapper"});var confirmFooterDiv=mQuery("<div />").attr({"class":"modal-body text-center"});var confirmHeaderDiv=mQuery("<div />").attr({"class":"modal-header"});confirmHeaderDiv.append(mQuery('<h4 />').attr({"class":"modal-title"}).text(message));var confirmButton=mQuery('<button type="button" />').addClass("btn btn-danger").css("marginRight","5px").css("marginLeft","5px").click(function(){if(typeof Mautic[confirmCallback]==="function"){window["Mautic"][confirmCallback].apply('window',[confirmAction]);}}).html(confirmText);if(cancelText){var cancelButton=mQuery('<button type="button" />').addClass("btn btn-primary").click(function(){if(typeof Mautic[cancelCallback]==="function"){window["Mautic"][cancelCallback].apply('window',[]);}}).html(cancelText);}
confirmFooterDiv.append(confirmButton);if(typeof cancelButton!='undefined'){confirmFooterDiv.append(cancelButton);}
confirmContentDiv.append(confirmHeaderDiv);confirmContentDiv.append(confirmFooterDiv);confirmContainer.append(confirmDialogDiv.append(confirmContentDiv));mQuery('body').append(confirmContainer);mQuery('.confirmation-modal').on('hidden.bs.modal',function(){mQuery(this).remove();});mQuery('.confirmation-modal').modal('show');},dismissConfirmation:function(){if(mQuery('.confirmation-modal').length){mQuery('.confirmation-modal').modal('hide');}},reorderTableData:function(name,orderby,tmpl,target){var route=window.location.pathname+"?tmpl="+tmpl+"&name="+name+"&orderby="+orderby;Mautic.loadContent(route,'','POST',target);},filterTableData:function(name,filterby,filterValue,tmpl,target){var query="action=setTableFilter&name="+name+"&filterby="+filterby+"&value="+filterValue;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){var route=window.location.pathname+"?tmpl="+tmpl;Mautic.loadContent(route,'','GET',target);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});},limitTableData:function(name,limit,tmpl,target){var query="action=setTableLimit&name="+name+"&limit="+limit;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){var route=window.location.pathname+"?tmpl="+tmpl;Mautic.loadContent(route,'','GET',target);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});},executeAction:function(action){Mautic.dismissConfirmation();mQuery.ajax({url:action,type:"POST",dataType:"json",success:function(response){Mautic.processPageContent(response);},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});},executeBatchAction:function(action){var items=JSON.stringify(mQuery('input[class=list-checkbox]:checked').map(function(){return mQuery(this).val();}).get());var action=action+'?ids='+items;Mautic.executeAction(action);},activateSearchAutocomplete:function(elId,modelName){if(mQuery('#'+elId).length){var livesearch=(mQuery('#'+elId).attr("data-toggle=['livesearch']"))?true:false;var engine=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace('value'),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mauticAjaxUrl+"?action=commandList&model="+modelName}});engine.initialize();mQuery('#'+elId).typeahead({hint:true,highlight:true,minLength:0,multiple:true},{name:elId,displayKey:'value',source:engine.ttAdapter()}).on('typeahead:selected',function(event,datum){if(livesearch){MauticVars.lastSearchStr='';mQuery('#'+elId).keyup();}}).on('typeahead:autocompleted',function(event,datum){if(livesearch){MauticVars.lastSearchStr='';mQuery('#'+elId).keyup();}}).on('keypress',function(event){if((event.keyCode||event.which)==13){mQuery('#'+elId).typeahead('close');}});}},activateLiveSearch:function(el,searchStrVar,liveCacheVar){if(!mQuery(el).length){return;}
mQuery(el).on('keyup',{},function(event){var searchStr=mQuery(el).val().trim();var target=mQuery(el).attr('data-target');var diff=searchStr.length-MauticVars[searchStrVar].length;if(diff<0){diff=parseInt(diff)*-1;}
var spaceKeyPressed=(event.which==32||event.keyCode==32);var enterKeyPressed=(event.which==13||event.keyCode==13);var deleteKeyPressed=(event.which==8||event.keyCode==8);var overlayEnabled=mQuery(el).attr('data-overlay');if(!overlayEnabled||overlayEnabled=='false'){overlayEnabled=false;}else{overlayEnabled=true;}
var overlayTarget=mQuery(el).attr('data-overlay-target');if(!overlayTarget)overlayTarget=target;if(!deleteKeyPressed&&overlayEnabled){var overlay=mQuery('<div />',{"class":"content-overlay"}).html(mQuery(el).attr('data-overlay-text'));if(mQuery(el).attr('data-overlay-background')){overlay.css('background',mQuery(el).attr('data-overlay-background'));}
if(mQuery(el).attr('data-overlay-color')){overlay.css('color',mQuery(el).attr('data-overlay-color'));}}
if(!MauticVars.searchIsActive&&((!searchStr&&MauticVars[searchStrVar].length)||diff>=3||spaceKeyPressed||enterKeyPressed)){MauticVars.searchIsActive=true;MauticVars[searchStrVar]=searchStr;event.data.livesearch=true;Mautic.filterList(event,mQuery(el).attr('id'),mQuery(el).attr('data-action'),target,liveCacheVar,overlayEnabled,overlayTarget);}else if(overlayEnabled){if(!mQuery(overlayTarget+' .content-overlay').length){mQuery(overlayTarget).prepend(overlay);}}});var btn="button[data-livesearch-parent='"+mQuery(el).attr('id')+"']";if(mQuery(btn).length){mQuery(btn).on('click',{'parent':mQuery(el).attr('id')},function(event){Mautic.filterList(event,event.data.parent,mQuery('#'+event.data.parent).attr('data-action'),mQuery('#'+event.data.parent).attr('data-target'),'liveCache',mQuery(this).attr('data-livesearch-action'));});if(mQuery(el).val()){mQuery(btn).attr('data-livesearch-action','clear');mQuery(btn+' i').removeClass('fa-search').addClass('fa-eraser');}else{mQuery(btn).attr('data-livesearch-action','search');mQuery(btn+' i').removeClass('fa-eraser').addClass('fa-search');}}},filterList:function(e,elId,route,target,liveCacheVar,action,overlayEnabled,overlayTarget){if(typeof liveCacheVar=='undefined'){liveCacheVar="liveCache";}
var el=mQuery('#'+elId);if(el.length&&(e.data.livesearch||mQuery(e.target).prop('tagName')=='BUTTON'||mQuery(e.target).parent().prop('tagName')=='BUTTON')){var value=el.val().trim();if(!value){action='clear';}else if(action=='clear'){el.val('');el.typeahead('val','');value='';}
var btn="button[data-livesearch-parent='"+elId+"']";if(mQuery(btn).length){if(action=='clear'){mQuery(btn).attr('data-livesearch-action','search');mQuery(btn).children('i').first().removeClass('fa-eraser').addClass('fa-search');}else{mQuery(btn).attr('data-livesearch-action','clear');mQuery(btn).children('i').first().removeClass('fa-search').addClass('fa-eraser');}}
if(false&&value&&value in MauticVars[liveCacheVar]){var response={"newContent":MauticVars[liveCacheVar][value]};response.target=target;response.overlayEnabled=overlayEnabled;response.overlayTarget=overlayTarget;Mautic.processPageContent(response);MauticVars.searchIsActive=false;}else{var searchName=el.attr('name');if(searchName=='undefined'){searchName='search';}
mQuery.ajax({url:route,type:"GET",data:searchName+"="+encodeURIComponent(value)+'&tmpl=list',dataType:"json",success:function(response){if(response.newContent){MauticVars[liveCacheVar][value]=response.newContent;}
response.target=target;response.overlayEnabled=overlayEnabled;response.overlayTarget=overlayTarget;Mautic.processPageContent(response);MauticVars.searchIsActive=false;},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});}}},removeFormListOption:function(el){var sortableDiv=mQuery(el).parents('div.sortable');var inputCount=mQuery(sortableDiv).parents('div.form-group').find('input.sortable-itemcount');var count=mQuery(inputCount).val();count--;mQuery(inputCount).val(count);mQuery(sortableDiv).remove();},togglePublishStatus:function(event,el,model,id,extra){event.preventDefault();mQuery(el).tooltip('destroy');MauticVars.liveCache=new Array();if(extra){extra='&'+extra;}
mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:"action=togglePublishStatus&model="+model+'&id='+id+extra,dataType:"json",success:function(response){Mautic.stopIconSpinPostEvent();if(response.statusHtml){mQuery(el).replaceWith(response.statusHtml);mQuery(el).tooltip({html:true,container:'body'});}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});},setSearchFilter:function(el,searchId){if(typeof searchId=='undefined')
searchId='#list-search';else
searchId='#'+searchId;var filter=mQuery(el).val();var current=mQuery('#list-search').typeahead('val');current+=" "+filter;mQuery(searchId).typeahead('val',current);var e=mQuery.Event("keypress",{which:13});e.data={};e.data.livesearch=true;Mautic.filterList(e,'list-search',mQuery(searchId).attr('data-action'),mQuery(searchId).attr('data-target'),'liveCache');mQuery(el).val('');},unlockEntity:function(model,id,parameter){mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:"action=unlockEntity&model="+model+"&id="+id+"&parameter="+parameter,dataType:"json"});},processAjaxError:function(request,textStatus,errorThrown){if(typeof mauticEnv!=='undefined'&&mauticEnv=='dev'){console.log(request);if(typeof request.responseJSON!=='undefined'&&typeof request.responseJSON.error!=='undefined'){var error=request.responseJSON.error.code+': '+errorThrown+'; '+request.responseJSON.error.exception;alert(error);}else if(typeof request.responseText!=='undefined'){var regex=/{(.+?)}}/g
var match=request.responseText.match(regex);if(match){var errorObj=mQuery.parseJSON(match);var error=errorObj.error.code+': '+errorThrown+'; '+errorObj.error.exception;alert(error);}}}},emulateNoDataForPieChart:function(data){var dataEmpty=true;mQuery.each(data,function(i,part){if(part.value){dataEmpty=false;}});if(dataEmpty){data=[{value:1,color:"#efeeec",highlight:"#EBEBEB",label:"No data"}];}
return data;}};;Mautic.clientOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','api.client');}};;Mautic.assetOnLoad=function(container){if(typeof Mautic.renderDownloadChartObject==='undefined'){Mautic.renderDownloadChart();}
mQuery("#asset_file").change(function(){Mautic.previewBeforeUpload(this);});};Mautic.assetOnUnload=function(id){if(id==='#app-content'){delete Mautic.renderDownloadChartObject;}};Mautic.getAssetId=function(){return mQuery('input#itemId').val();}
Mautic.renderDownloadChart=function(chartData){if(!mQuery('#download-chart').length){return;}
if(!chartData){chartData=mQuery.parseJSON(mQuery('#download-chart-data').text());}
var ctx=document.getElementById("download-chart").getContext("2d");var options={};if(typeof Mautic.renderDownloadChartObject==='undefined'){Mautic.renderDownloadChartObject=new Chart(ctx).Line(chartData,options);}else{Mautic.renderDownloadChartObject.destroy();Mautic.renderDownloadChartObject=new Chart(ctx).Line(chartData,options);}};Mautic.updateDownloadChart=function(element,amount,unit){var element=mQuery(element);var wrapper=element.closest('ul');var button=mQuery('#time-scopes .button-label');var assetId=Mautic.getAssetId();wrapper.find('a').removeClass('bg-primary');element.addClass('bg-primary');button.text(element.text());var query="action=asset:updateDownloadChart&amount="+amount+"&unit="+unit+"&assetId="+assetId;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){Mautic.renderDownloadChart(response.stats);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});}
Mautic.previewBeforeUpload=function(input){if(input.files&&input.files[0]){var filename=input.files[0].name.toLowerCase();var extension=filename.substr((filename.lastIndexOf('.')+1));var reader=new FileReader();var element=mQuery('<i />').addClass('fa fa-upload fa-5x');if(mQuery.inArray(extension,['jpg','jpeg','gif','png'])!==-1){reader.onload=function(e){element=mQuery('<img />').addClass('img-thumbnail').attr('src',e.target.result);mQuery('.thumbnail-preview').empty().append(element);}}else if(extension==='pdf'){reader.onload=function(e){element=mQuery('<iframe />').attr('src',e.target.result);mQuery('.thumbnail-preview').empty().append(element);}}
mQuery('.thumbnail-preview').empty().append(element);reader.readAsDataURL(input.files[0]);}};Mautic.calendarOnLoad=function(container){mQuery('#calendar').fullCalendar({events:mauticAjaxUrl+"?action=calendar:generateData",eventRender:function(event,element){if(event.iconClass){element.find('.fc-title').before(mQuery('<i />').addClass(event.iconClass));}
if(event.attr){element.attr(event.attr);}
if(event.description){element.tooltip({'title':event.description});}}});};;Mautic.campaignOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','campaign');}
if(mQuery('#CampaignEventPanel').length){mQuery('#CampaignCanvas').droppable({drop:function(event,ui){mQuery('#droppedX').val(ui.position.left);mQuery('#droppedY').val(ui.position.top);mQuery('#'+ui.draggable.attr('id')).click();}});mQuery('#CampaignEventPanel .list-group-item').draggable({helper:'clone',appendTo:'#CampaignCanvas',zIndex:8000,scrollSensitivity:100,scrollSpeed:15,cursorAt:{top:15,left:15}});mQuery('#CampaignCanvas .list-campaign-event').off('.eventbuttons').on('mouseover.eventbuttons',function(){mQuery(this).find('.campaign-event-buttons').removeClass('hide');}).on('mouseout.eventbuttons',function(){mQuery(this).find('.campaign-event-buttons').addClass('hide');}).on('dblclick.eventbuttons',function(event){event.preventDefault();mQuery(this).find('.btn-edit').first().click();});}
if(mQuery("#shuffle-grid").length){Mautic.campaignLeadsOnLoad(container);}
Mautic.renderCampaignViewsBarChart();Mautic.renderCampaignEmailSentPie();Mautic.renderCampaignLeadsBarChart();};Mautic.campaignOnUnload=function(container){delete Mautic.campaignBuilderInstance;if(container==='#app-content'){delete Mautic.campaignViewsBarChart;delete Mautic.campaignEmailSentPie;delete Mautic.campaignLeadsBarChart;}}
Mautic.campaignEventOnLoad=function(container,response){if(response.deleted){var domEventId='CampaignEvent_'+response.eventId;var eventId='#'+domEventId;Mautic.campaignBuilderInstance.detachAllConnections(document.getElementById(domEventId));mQuery('.'+domEventId).each(function(){mQuery(this).remove();});mQuery(eventId).remove();}else if(response.updateHtml){var domEventId='CampaignEvent_'+response.eventId;var eventId='#'+domEventId;if(response.label){Mautic.campaignBuilderUpdateLabel(domEventId,response.label);}else{Mautic.campaignBuilderUpdateLabel(domEventId,false);}
mQuery(eventId+" .campaign-event-content").html(response.updateHtml);}else if(response.eventHtml){var newHtml=response.eventHtml;var domEventId='CampaignEvent_'+response.eventId;var eventId='#'+domEventId;var x=mQuery('#droppedX').val();var y=mQuery('#droppedY').val();mQuery(newHtml).appendTo('#CampaignCanvas');mQuery(eventId).css({'left':x+'px','top':y+'px'});if(response.eventType=='decision'){var theAnchor=Mautic.campaignBuilderTopAnchor;theAnchor[6]='top '+domEventId;Mautic.campaignBuilderInstance.addEndpoint(domEventId,{anchor:theAnchor,uuid:domEventId+"_top"},Mautic.campaignBuilderTopEndpoint);var theAnchor=Mautic.campaignBuilderYesAnchor;theAnchor[6]='yes '+domEventId;Mautic.campaignBuilderInstance.addEndpoint(domEventId,{anchor:theAnchor,uuid:domEventId+"_yes"},Mautic.campaignBuilderYesEndpoint);var theAnchor=Mautic.campaignBuilderNoAnchor;theAnchor[6]='no '+domEventId;Mautic.campaignBuilderInstance.addEndpoint(domEventId,{anchor:theAnchor,uuid:domEventId+"_no"},Mautic.campaignBuilderNoEndpoint);}else{var theAnchor=Mautic.campaignBuilderTopAnchor;theAnchor[6]='top '+domEventId;Mautic.campaignBuilderInstance.addEndpoint(domEventId,{anchor:theAnchor,uuid:domEventId+"_top"},Mautic.campaignBuilderTopEndpoint);var theAnchor=Mautic.campaignBuilderBottomAnchor;theAnchor[6]='bottom '+domEventId;Mautic.campaignBuilderInstance.addEndpoint(domEventId,{anchor:theAnchor,uuid:domEventId+"_bottom"},Mautic.campaignBuilderBottomEndpoint);}
Mautic.campaignBuilderInstance.draggable(domEventId,Mautic.campaignDragOptions);mQuery(eventId+" a[data-toggle='ajax']").click(function(event){event.preventDefault();return Mautic.ajaxifyLink(this,event);});mQuery(eventId+" a[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Mautic.ajaxifyModal(this,event);});mQuery(eventId).off('.eventbuttons').on('mouseover.eventbuttons',function(){mQuery(this).find('.campaign-event-buttons').removeClass('hide');}).on('mouseout.eventbuttons',function(){mQuery(this).find('.campaign-event-buttons').addClass('hide');}).on('dblclick.eventbuttons',function(event){event.preventDefault();mQuery(this).find('.btn-edit').first().click();});mQuery(eventId+" *[data-toggle='tooltip']").tooltip({html:true});}
Mautic.campaignBuilderInstance.repaintEverything();};Mautic.campaignBuilderUpdateLabel=function(domEventId,theLabel){var currentConnections=Mautic.campaignBuilderInstance.select({target:domEventId});if(currentConnections.length>0){currentConnections.each(function(conn){var overlays=conn.getOverlays();if(overlays.length>0){mQuery.each(overlays,function(index,overlay){if(overlay.type=='Label'){conn.removeOverlay(overlay.id);}});}
if(theLabel){conn.addOverlay(["Label",{label:theLabel,location:0.65,cssClass:"_jsPlumb_label",id:conn.sourceId+"_"+conn.targetId+"_connectionLabel"}]);}});}};Mautic.updateCampaignEventLinks=function(){var campaignType=mQuery('#campaign_type .active input').val();if(typeof campaignType=='undefined'){campaignType='interval';}
mQuery('#campaignEventList a').each(function(){var href=mQuery(this).attr('href');var newType=(campaignType=='interval')?'date':'interval';href=href.replace('campaignType='+campaignType,'campaignType='+newType);mQuery(this).attr('href',href);});};Mautic.launchCampaignEditor=function(){Mautic.stopIconSpinPostEvent();mQuery('.builder').addClass('builder-active');mQuery('.builder').removeClass('hide');if(typeof Mautic.campaignBuilderInstance=='undefined'){Mautic.campaignBuilderInstance=jsPlumb.getInstance({Container:document.querySelector("#CampaignCanvas")});Mautic.updateCampaignConnections=function(info,remove){remove=(remove)?1:0;var sourceId=info.connection.sourceId;var targetId=info.connection.targetId;var sourceEndpoint=info.sourceEndpoint.anchor.cssClass;var targetEndpoint=info.targetEndpoint.anchor.cssClass;var campaignId=mQuery('#campaignId').val();var query="action=campaign:updateConnections&campaignId="+campaignId+"&source="+sourceId+"&target="+targetId+"&remove="+remove+"&sourceEndpoint="+sourceEndpoint+"&targetEndpoint="+targetEndpoint;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(!remove&&response.label){info.connection.addOverlay(["Label",{label:response.label,location:0.65,cssClass:'_jsPlumb_label',id:sourceId+"_"+targetId+"_connectionLabel"}]);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.campaignBuilderInstance.bind("connection",function(info,originalEvent){if(typeof originalEvent!='undefined'){Mautic.updateCampaignConnections(info);}});Mautic.campaignBuilderInstance.bind("connectionDetached",function(info,originalEvent){Mautic.updateCampaignConnections(info,true);});var overlayOptions=[["Arrow",{width:15,length:15,location:0.5}]];var endpoint="Dot";var connector=["Bezier",{curviness:25}];var connectorStyleLineWidth=3;Mautic.campaignBuilderTopAnchor=[0.5,0,0,-1,0,0];Mautic.campaignBuilderTopEndpoint={endpoint:endpoint,paintStyle:{fillStyle:"#d5d4d4"},connector:connector,connectorOverlays:overlayOptions,isTarget:true,beforeDrop:function(params){var currentConnections=Mautic.campaignBuilderInstance.select({source:params.targetId,target:params.sourceId});if(currentConnections.length>=1){return false;}
if(params.sourceId==params.targetId){return false;}
if(mQuery('#'+params.sourceId).hasClass('list-campaign-action')&&mQuery('#'+params.targetId).hasClass('list-campaign-action')){return false;}
if(mQuery('#'+params.sourceId).hasClass('list-campaign-decision')&&mQuery('#'+params.targetId).hasClass('list-campaign-decision')){return false;}
return true}};Mautic.campaignBuilderBottomAnchor=[0.5,1,0,1,0,0];Mautic.campaignBuilderBottomEndpoint={endpoint:endpoint,paintStyle:{fillStyle:"#d5d4d4"},connector:connector,connectorOverlays:overlayOptions,maxConnections:-1,isSource:true,connectorStyle:{strokeStyle:"#d5d4d4",lineWidth:connectorStyleLineWidth}};Mautic.campaignBuilderYesAnchor=[0,1,0,1,30,0];Mautic.campaignBuilderYesEndpoint={endpoint:endpoint,paintStyle:{fillStyle:"#00b49c"},connector:connector,connectorOverlays:overlayOptions,maxConnections:-1,isSource:true,connectorStyle:{strokeStyle:"#00b49c",lineWidth:connectorStyleLineWidth}};Mautic.campaignBuilderNoAnchor=[1,1,0,1,-30,0];Mautic.campaignBuilderNoEndpoint={endpoint:endpoint,paintStyle:{fillStyle:"#f86b4f"},connector:connector,connectorOverlays:overlayOptions,maxConnections:-1,isSource:true,connectorStyle:{strokeStyle:"#f86b4f",lineWidth:connectorStyleLineWidth}};Mautic.campaignDragOptions={start:function(params){this.startingPosition=mQuery(params.el).position();},stop:function(params){var endingPosition=mQuery(params.el).position();if(this.startingPosition.left!==endingPosition.left||this.startingPosition.top!==endingPosition.top){mQuery('#droppedX').val(params.pos[0]);mQuery('#droppedY').val(params.pos[1]);var campaignId=mQuery('#campaignId').val();var query="action=campaign:updateCoordinates&campaignId="+campaignId+"&droppedX="+params.pos[0]+"&droppedY="+params.pos[1]+"&eventId="+mQuery(params.el).attr('id');mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});}}};Mautic.campaignBuilderInstance.setSuspendDrawing(true);mQuery("#CampaignCanvas .list-campaign-event").each(function(){var id=mQuery(this).attr('id');var theAnchor=Mautic.campaignBuilderTopAnchor;theAnchor[6]='top '+id;Mautic.campaignBuilderInstance.addEndpoint(id,{anchor:theAnchor,uuid:id+"_top"},Mautic.campaignBuilderTopEndpoint);});mQuery("#CampaignCanvas .list-campaign-nondecision").each(function(){var id=mQuery(this).attr('id');var theAnchor=Mautic.campaignBuilderBottomAnchor;theAnchor[6]='bottom '+id;Mautic.campaignBuilderInstance.addEndpoint(id,{anchor:theAnchor,uuid:id+"_bottom"},Mautic.campaignBuilderBottomEndpoint);});mQuery("#CampaignCanvas .list-campaign-decision").each(function(){var id=mQuery(this).attr('id');var theAnchor=Mautic.campaignBuilderYesAnchor;theAnchor[6]='yes '+id;Mautic.campaignBuilderInstance.addEndpoint(id,{anchor:theAnchor,uuid:id+"_yes"},Mautic.campaignBuilderYesEndpoint);var theAnchor=Mautic.campaignBuilderNoAnchor;theAnchor[6]='no '+id;Mautic.campaignBuilderInstance.addEndpoint(id,{anchor:theAnchor,uuid:id+"_no"},Mautic.campaignBuilderNoEndpoint);});Mautic.campaignBuilderInstance.draggable(document.querySelectorAll("#CampaignCanvas .list-campaign-event"),Mautic.campaignDragOptions);Mautic.campaignBuilderReconnectEndpoints();Mautic.campaignBuilderInstance.setSuspendDrawing(false,true);mQuery('.builder-content').scroll(function(){Mautic.campaignBuilderInstance.repaintEverything();});}else{Mautic.campaignBuilderInstance.repaintEverything();}};Mautic.campaignToggleTimeframes=function(){var immediateChecked=mQuery('#campaignevent_triggerMode_0').prop('checked');var intervalChecked=mQuery('#campaignevent_triggerMode_1').prop('checked');var dateChecked=mQuery('#campaignevent_triggerMode_2').prop('checked');if(mQuery('#campaignevent_triggerInterval').length){if(immediateChecked){mQuery('#triggerInterval').addClass('hide');mQuery('#triggerDate').addClass('hide');}else if(intervalChecked){mQuery('#triggerInterval').removeClass('hide');mQuery('#triggerDate').addClass('hide');}else if(dateChecked){mQuery('#triggerInterval').addClass('hide');mQuery('#triggerDate').removeClass('hide');}}};Mautic.closeCampaignBuilder=function(){mQuery('.builder').addClass('hide');};Mautic.submitCampaignEvent=function(e){e.preventDefault();mQuery('#campaignevent_canvasSettings_droppedX').val(mQuery('#droppedX').val());mQuery('#campaignevent_canvasSettings_droppedY').val(mQuery('#droppedY').val());mQuery('#campaignevent_canvasSettings_decisionPath').val(mQuery('#decisionPath').val());mQuery('form[name="campaignevent"]').submit();};Mautic.renderCampaignViewsBarChart=function(container){if(!mQuery('#campaign-views-chart').length){return;}
chartData=mQuery.parseJSON(mQuery('#campaign-views-chart-data').text());if(typeof chartData.labels==="undefined"){return;}
var ctx=document.getElementById("campaign-views-chart").getContext("2d");var options={scaleShowGridLines:false,barShowStroke:false,barValueSpacing:1,showScale:false,tooltipFontSize:10,tooltipCaretSize:0}
if(typeof Mautic.campaignViewsBarChart==='undefined'){Mautic.campaignViewsBarChart=new Chart(ctx).Bar(chartData,options);}};Mautic.renderCampaignLeadsBarChart=function(container){if(!mQuery('#campaign-leads-chart').length){return;}
chartData=mQuery.parseJSON(mQuery('#campaign-leads-chart-data').text());if(typeof chartData.labels==="undefined"){return;}
var ctx=document.getElementById("campaign-leads-chart").getContext("2d");var options={scaleShowGridLines:false,barShowStroke:false,barValueSpacing:1,showScale:false,tooltipFontSize:10,tooltipCaretSize:0}
if(typeof Mautic.campaignLeadsBarChart==='undefined'){Mautic.campaignLeadsBarChart=new Chart(ctx).Bar(chartData,options);}};Mautic.renderCampaignEmailSentPie=function(){if(typeof Mautic.campaignEmailSentPie==='object'){return;}
var element=mQuery('#emails-sent-rate');if(!element.length){return;}
var options={responsive:false,tooltipFontSize:10,tooltipTemplate:"<%if (label){%><%}%><%= value %>x <%=label%>"};var timesOnSiteData=mQuery.parseJSON(mQuery('#emails-sent-data').text());timesOnSiteData=Mautic.emulateNoDataForPieChart(timesOnSiteData);var ctx=document.getElementById("emails-sent-rate").getContext("2d");Mautic.campaignEmailSentPie=new Chart(ctx).Pie(timesOnSiteData,options);};Mautic.campaignLeadsOnLoad=function(){if(mQuery('shuffle-grid').length){var grid=mQuery("#shuffle-grid");grid.shuffle({itemSelector:".shuffle"});mQuery("html").on("fa.sidebar.minimize",function(){grid.shuffle("update");}).on("fa.sidebar.maximize",function(){grid.shuffle("update");});}};;Mautic.categoryOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','category');}
if(response&&response.closeModal){mQuery(container+' .modal-form-buttons').html('');}};;Mautic.activateChatListUpdate=function(){Mautic['chatListUpdaterInterval']=setInterval(function(){if(mQuery('#ChatUsers').length){Mautic.updateChatList();}else{clearInterval(Mautic['chatListUpdaterInterval']);}},30000);};Mautic.updateChatList=function(killTimer){mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=chat:updateList",dataType:"json",success:function(response){mQuery('#OffCanvasRightHeaderTitle').html('');mQuery('#ChatSubHeader').html('');mQuery('#ChatList').replaceWith(response.newContent);response.target='#ChatList';Mautic.processPageContent(response);if(killTimer){clearInterval(Mautic['chatUpdaterInterval']);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.startUserChat=function(userId,fromDate){if(typeof fromDate=='undefined'){fromDate='';}
mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=chat:startUserChat",data:'chatId='+userId+'&from='+fromDate,dataType:"json",success:function(response){if(response.success){mQuery('#OffCanvasRightHeaderTitle').html(response.withName);if(response.lastSeen){mQuery('#ChatSubHeader').html(response.lastSeen);}
Mautic.updateChatConversation(response);Mautic.activateChatUpdater(response.withId,'user');Mautic.activateChatInput(response.withId,'user');response.target=".offcanvas-right";Mautic.processPageContent(response);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.startChannelChat=function(channelId,fromDate){if(typeof fromDate=='undefined'){fromDate='';}
mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=chat:startChannelChat",data:'chatId='+channelId+'&from='+fromDate,dataType:"json",success:function(response){if(response.success){mQuery('#OffCanvasRightHeaderTitle').html(response.channelName);Mautic.updateChatConversation(response);Mautic.activateChatUpdater(response.channelId,'channel');Mautic.activateChatInput(response.channelId,'channel');response.target="#OffCanvasRightContent";Mautic.processPageContent(response);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.activateChatInput=function(itemId,chatType){mQuery('#ChatMessageInput').off('keydown.chat');mQuery('#ChatMessageInput').on('keydown.chat',function(e){if(e.which==10||e.which==13){Mautic.sendChatMessage(itemId,chatType);}
if(mQuery('.chat-new-divider').length){mQuery('.chat-new-divider').remove();}});mQuery('#ChatMessageInput').off('click.chat');mQuery('#ChatMessageInput').on('click.chat',function(e){if(mQuery('.chat-new-divider').length){mQuery('.chat-new-divider').remove();Mautic.markMessagesRead(itemId,chatType);}});};Mautic.getLastChatGroup=function(){var group=mQuery('#ChatConversation .chat-group').last().find('.chat-group-firstid');return group.length?group.val():'';};Mautic.markMessagesRead=function(itemId,chatType){var lastId=mQuery('#ChatLastMessageId').val();mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=chat:markRead",data:'chatId='+itemId+'&chatType='+chatType+'&lastId='+lastId,dataType:"json"});};Mautic.activateChatUpdater=function(itemId,chatType){Mautic['chatUpdaterInterval']=setInterval(function(){var lastId=mQuery('#ChatLastMessageId').val();var groupId=Mautic.getLastChatGroup();if(mQuery('#ChatUsers').length){mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=chat:getMessages",data:'chatId='+itemId+'&chatType='+chatType+'&lastId='+lastId+'&groupId='+groupId,dataType:"json",success:function(response){Mautic.updateChatConversation(response,chatType);},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});}else{clearInterval(Mautic['chatUpdateInterval']);}},10000);};Mautic.sendChatMessage=function(toId,chatType){var msgText=mQuery('#ChatMessageInput').val();mQuery('#ChatMessageInput').val('');var lastId=mQuery('#ChatLastMessageId').val();var groupId=Mautic.getLastChatGroup();if(msgText){var dataObj={chatId:toId,msg:msgText,lastId:lastId,groupId:groupId,chatType:chatType};mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=chat:sendMessage",data:dataObj,dataType:"json",success:function(response){Mautic.updateChatConversation(response,chatType);},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});}};Mautic.updateChatConversation=function(response,chatType)
{var dividerAppended=false;var contentUpdated=false;clearInterval(Mautic['chatListUpdaterInterval']);if(response.conversationHtml){mQuery('#OffCanvasRightContent').html(response.conversationHtml);}
if(response.firstId&&mQuery('#ChatMessage'+response.firstId).length){return;}
var useId=(chatType=='user')?'ChatWithUserId':'ChatChannelId';if(mQuery('#'+useId).length&&mQuery('#'+useId).val()==response.withId){if(!mQuery('.chat-new-divider').length&&response.divider){if(response.lastReadId&&response.lastReadId!=response.latestId&&mQuery('#ChatMessage'+response.lastReadId).length){dividerAppended=true;mQuery(response.divider).insertAfter('#ChatMessage'+response.lastReadId);}}
if(response.appendToGroup){if(!dividerAppended&&!mQuery('.chat-new-divider').length&&response.divider){dividerAppended=true;mQuery('#ChatGroup'+response.groupId+' .media-body').append(response.divider);}
mQuery('#ChatGroup'+response.groupId+' .media-body').append(response.appendToGroup);contentUpdated=true;}
if(response.messages){if(!dividerAppended&&!mQuery('.chat-new-divider').length&&response.divider){mQuery('#ChatMessages').append(response.divider);}
mQuery('#ChatMessages').append(response.messages);contentUpdated=true;}}
if(contentUpdated){mQuery('#ChatConversation').scrollTop(mQuery('#ChatConversation').scrollHeight);}
if(response.latestId){var currentLastId=mQuery('#ChatLastMessageId').val();if(response.latestId>currentLastId){mQuery('#ChatLastMessageId').val(response.latestId);}}};Mautic.addChatChannel=function(){mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=chat:addChannel",dataType:"json",success:function(response){},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.chatChannelOnLoad=function(container,response){if(response.chatHtml){mQuery('#OffCanvasMainContent').html(response.chatHtml);}};;Mautic.dashboardOnLoad=function(container){Mautic.renderDashboardMap();Mautic.renderOpenRateDoughnut();Mautic.renderClickRateDoughnut();Mautic.updateActiveVisitorCount();};Mautic.dashboardOnUnload=function(id){mQuery('.jqvmap-label').remove();if(id==='#app-content'){delete Mautic.dashboardMapData;delete Mautic.dashboardClickRateDoughnutObject;delete Mautic.dashboardOpenRateDoughnutObject;delete Mautic.ActiveVisitorsCount;}};Mautic.renderDashboardMap=function(){if(typeof Mautic.dashboardMapData==='object'){return;}
Mautic.dashboardMapData=mQuery.parseJSON(mQuery('#dashboard-map-data').text());jQuery('#dashboard-map').vectorMap({map:'world_en',backgroundColor:null,color:'#ffffff',hoverOpacity:0.7,selectedColor:'#666666',enableZoom:true,showTooltip:true,values:Mautic.dashboardMapData,scaleColors:['#C8EEFF','#006491'],normalizeFunction:'polynomial',onLabelShow:function(event,label,code){if(Mautic.dashboardMapData[code]>0){label.append(': '+Mautic.dashboardMapData[code]+' Leads');}}});}
Mautic.renderOpenRateDoughnut=function(){if(typeof Mautic.dashboardOpenRateDoughnutObject==='object'){return;}
var element=mQuery('#open-rate');var sentCount=+element.attr('data-sent-count');var readCount=+element.attr('data-read-count');var options={percentageInnerCutout:65,responsive:false}
var data=[{value:readCount,color:"#4E5D9D",highlight:"#353F6A",label:"Opened"},{value:sentCount-readCount,color:"#efeeec",highlight:"#EBEBEB",label:"Not opened"}];data=Mautic.emulateNoDataForPieChart(data);var ctx=document.getElementById("open-rate").getContext("2d");Mautic.dashboardOpenRateDoughnutObject=new Chart(ctx).Doughnut(data,options);}
Mautic.renderClickRateDoughnut=function(){if(typeof Mautic.dashboardClickRateDoughnutObject==='object'){return;}
var element=mQuery('#click-rate');var readCount=+element.attr('data-read-count');var clickCount=+element.attr('data-click-count');var options={percentageInnerCutout:65,responsive:false}
var data=[{value:clickCount,color:"#35B4B9",highlight:"#227276",label:"Clicked"},{value:readCount-clickCount,color:"#efeeec",highlight:"#EBEBEB",label:"Not clicked"}];data=Mautic.emulateNoDataForPieChart(data);var ctx=document.getElementById("click-rate").getContext("2d");Mautic.dashboardClickRateDoughnutObject=new Chart(ctx).Doughnut(data,options);}
Mautic.updateActiveVisitorCount=function(){mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:"action=dashboard:viewingVisitors",dataType:"json",success:function(response){if(response.success){var element=mQuery('#active-visitors');element.text(response.viewingVisitors);if(response.viewingVisitors!=Mautic.ActiveVisitorsCount){var color='#34D43B';if(Mautic.ActiveVisitorsCount>response.viewingVisitors){color='#BC2525';}
element.css('text-shadow',color+' 0px 0px 50px');setTimeout(function(){element.css('text-shadow','#fff 0px 0px 50px');},3000);}
Mautic.ActiveVisitorsCount=response.viewingVisitors;}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.emailOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','email');}
if(typeof Mautic.listCompareChart==='undefined'){Mautic.renderListCompareChart();}
Mautic.initializeEmailFilters(container);};Mautic.emailUnLoad=function(){mQuery('.builder').remove();};Mautic.emailOnUnload=function(id){if(id==='#app-content'){delete Mautic.listCompareChart;}};Mautic.launchEmailEditor=function(){var src=mQuery('#EmailBuilderUrl').val();src+='?template='+mQuery('#emailform_template').val();var builder=mQuery("<iframe />",{css:{margin:"0",padding:"0",border:"none",width:"100%",height:"100%"},id:"builder-template-content"}).attr('src',src).appendTo('.builder-content').load(function(){var $this=mQuery(this);var contents=$this.contents();contents.find('.mautic-editable').droppable({iframeFix:true,drop:function(event,ui){var instance=mQuery(this).attr("id");var predrop=mQuery(ui.draggable).data('predrop');if(predrop){Mautic[predrop](event,ui,instance);}else{var editor=Mautic.getEmailBuilderEditorInstances();var token=mQuery(ui.draggable).data('token');if(token){editor[instance].insertText(token);}}
mQuery(this).removeClass('over-droppable');},over:function(e,ui){mQuery(this).addClass('over-droppable');},out:function(e,ui){mQuery(this).removeClass('over-droppable');}});});mQuery('.builder').addClass('builder-active');mQuery('.builder').removeClass('hide');Mautic.emailEditorOnLoad('.builder-panel');};Mautic.getEmailBuilderEditorInstances=function(){return document.getElementById('builder-template-content').contentWindow.CKEDITOR.instances;};Mautic.closeEmailEditor=function(){Mautic.stopIconSpinPostEvent();mQuery('.builder').addClass('hide');mQuery('#builder-template-content').contents().find('.mautic-editable').each(function(index){mQuery(this).blur();});setTimeout(function(){mQuery('#builder-template-content').contents().find('.mautic-editable').droppable('destroy');mQuery("*[data-token]").draggable('destroy');mQuery('#builder-template-content').remove();},3000);};Mautic.emailEditorOnLoad=function(container){mQuery(container+" *[data-token]").draggable({iframeFix:true,iframeId:'builder-template-content',helper:'clone',appendTo:'.builder',zIndex:8000,scroll:true,scrollSensitivity:100,scrollSpeed:100,cursorAt:{top:15,left:15}});};Mautic.renderListCompareChart=function(){if(!mQuery("#list-compare-chart").length){return;}
var options={};var data=mQuery.parseJSON(mQuery('#list-compare-chart-data').text());Mautic.listCompareChart=new Chart(document.getElementById("list-compare-chart").getContext("2d")).Bar(data,options);};Mautic.initializeEmailFilters=function(container){var emailForm=mQuery(container+' #email-filters');if(emailForm.length){emailForm.on('change',function(){emailForm.submit();}).on('keyup',function(){emailForm.delay(200).submit();}).on('submit',function(e){e.preventDefault();var formData=emailForm.serialize();var request=window.location.pathname+'?tmpl=list&name=email&'+formData;Mautic.loadContent(request,'','POST','.page-list');});}};Mautic.insertEmailBuilderToken=function(editorId,token){var editor=Mautic.getEmailBuilderEditorInstances();editor[instance].insertText(token);};Mautic.toggleEmailContentMode=function(el){var builder=(mQuery(el).val()==='0')?false:true;if(builder){mQuery('#customHtmlContainer').addClass('hide');mQuery('#builderHtmlContainer').removeClass('hide');}else{mQuery('#customHtmlContainer').removeClass('hide');mQuery('#builderHtmlContainer').addClass('hide');}};Mautic.getEmailAbTestWinnerForm=function(abKey){if(abKey&&mQuery(abKey).val()&&mQuery(abKey).closest('.form-group').hasClass('has-error')){mQuery(abKey).closest('.form-group').removeClass('has-error');if(mQuery(abKey).next().hasClass('help-block')){mQuery(abKey).next().remove();}}
var labelSpinner=mQuery("label[for='email_variantSettings_winnerCriteria']");var spinner=mQuery('<i class="fa fa-fw fa-spinner fa-spin"></i>');labelSpinner.append(spinner);var emailId=mQuery('#email_sessionId').val();var query="action=email:getAbTestForm&abKey="+mQuery(abKey).val()+"&emailId="+emailId;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){if(mQuery('#email_variantSettings_properties').length){mQuery('#email_variantSettings_properties').replaceWith(response.html);}else{mQuery('#email_variantSettings').append(response.html);}
if(response.html!=''){Mautic.onPageLoad('#email_variantSettings_properties',response);}}
spinner.remove();},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);spinner.remove();}});};;Mautic.formOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','form.form');}
if(mQuery('#mauticforms_fields')){mQuery('#mauticforms_fields').sortable({items:'.mauticform-row',handle:'.reorder-handle',stop:function(i){mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=form:reorderFields",data:mQuery('#mauticforms_fields').sortable("serialize")+"&formId="+mQuery('#mauticform_sessionId').val()})}});mQuery('#mauticforms_fields .mauticform-row').on('mouseover.mauticformfields',function(){mQuery(this).find('.form-buttons').removeClass('hide');}).on('mouseout.mauticformfields',function(){mQuery(this).find('.form-buttons').addClass('hide');});}
if(mQuery('#mauticforms_actions')){mQuery('#mauticforms_actions').sortable({items:'.mauticform-row',handle:'.reorder-handle',stop:function(i){mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=form:reorderActions",data:mQuery('#mauticforms_actions').sortable("serialize")+"&formId="+mQuery('#mauticform_sessionId').val()});}});mQuery('#mauticforms_actions .mauticform-row').on('mouseover.mauticformactions',function(){mQuery(this).find('.form-buttons').removeClass('hide');}).on('mouseout.mauticformactions',function(){mQuery(this).find('.form-buttons').addClass('hide');});}
if(typeof Mautic.formSubmissionChart==='undefined'){Mautic.renderSubmissionChart();}};Mautic.getFormId=function(){return mQuery('input#formId').val();}
Mautic.formOnUnload=function(id){if(id==='#app-content'){delete Mautic.formSubmissionChart;}};Mautic.formFieldOnLoad=function(container,response){if(response.fieldHtml){var newHtml=response.fieldHtml;var fieldId='#mauticform_'+response.fieldId;if(mQuery(fieldId).length){mQuery(fieldId).replaceWith(newHtml);var newField=false;}else{mQuery(newHtml).appendTo('#mauticforms_fields');var newField=true;}
mQuery(fieldId+" a[data-toggle='ajax']").click(function(event){event.preventDefault();return Mautic.ajaxifyLink(this,event);});mQuery(fieldId+" *[data-toggle='tooltip']").tooltip({html:true});mQuery(fieldId+" a[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Mautic.ajaxifyModal(this,event);});mQuery('#mauticforms_fields .mauticform-row').off(".mauticform");mQuery('#mauticforms_fields .mauticform-row').on('mouseover.mauticformfields',function(){mQuery(this).find('.form-buttons').removeClass('hide');}).on('mouseout.mauticformfields',function(){mQuery(this).find('.form-buttons').addClass('hide');});if(!mQuery('#fields-panel').hasClass('in')){mQuery('a[href="#fields-panel"]').trigger('click');}
if(newField){mQuery('.bundle-main-inner-wrapper').scrollTop(mQuery('.bundle-main-inner-wrapper').height());}
if(mQuery('#form-field-placeholder').length){mQuery('#form-field-placeholder').remove();}}};Mautic.formActionOnLoad=function(container,response){if(response.actionHtml){var newHtml=response.actionHtml;var actionId='#mauticform_action_'+response.actionId;if(mQuery(actionId).length){mQuery(actionId).replaceWith(newHtml);var newField=false;}else{mQuery(newHtml).appendTo('#mauticforms_actions');var newField=true;}
mQuery(actionId+" a[data-toggle='ajax']").click(function(event){event.preventDefault();return Mautic.ajaxifyLink(this,event);});mQuery(actionId+" *[data-toggle='tooltip']").tooltip({html:true});mQuery(actionId+" a[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Mautic.ajaxifyModal(this,event);});mQuery('#mauticforms_actions .mauticform-row').off(".mauticform");mQuery('#mauticforms_actions .mauticform-row').on('mouseover.mauticformactions',function(){mQuery(this).find('.form-buttons').removeClass('hide');}).on('mouseout.mauticformactions',function(){mQuery(this).find('.form-buttons').addClass('hide');});if(!mQuery('#actions-panel').hasClass('in')){mQuery('a[href="#actions-panel"]').trigger('click');}
if(newField){mQuery('.bundle-main-inner-wrapper').scrollTop(mQuery('.bundle-main-inner-wrapper').height());}
if(mQuery('#form-action-placeholder').length){mQuery('#form-action-placeholder').remove();}}
var userLookup=mQuery('#formaction_properties_user_lookup');if(userLookup.length){var users=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace('label'),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mauticAjaxUrl+"?action=user:userList",},remote:{url:mauticAjaxUrl+"?action=user:userList&filter=%QUERY"},dupDetector:function(remoteMatch,localMatch){return(remoteMatch.label==localMatch.label);},ttl:1800000,limit:5});users.initialize();userLookup.typeahead({hint:true,highlight:true,minLength:2},{name:'formaction_properties_user_lookup',displayKey:'label',source:users.ttAdapter()}).on('typeahead:selected',function(event,datum){mQuery("#formaction_properties_user_id").val(datum["value"]);}).on('typeahead:autocompleted',function(event,datum){mQuery("#formaction_properties_user_id").val(datum["value"]);}).on('keypress',function(event){if((event.keyCode||event.which)==13){userLookup.typeahead('close');}});}};Mautic.onPostSubmitActionChange=function(value){if(value=='return'){mQuery('#mauticform_postActionProperty').prev().removeClass('required');}else{mQuery('#mauticform_postActionProperty').prev().addClass('required');}
mQuery('#mauticform_postActionProperty').next().html('');mQuery('#mauticform_postActionProperty').parent().removeClass('has-error');};Mautic.renderSubmissionChart=function(chartData){if(!mQuery('#submission-chart').length){return;}
if(!chartData){chartData=mQuery.parseJSON(mQuery('#submission-chart-data').text());}
var ctx=document.getElementById("submission-chart").getContext("2d");var options={};if(typeof Mautic.formSubmissionChart==='undefined'){Mautic.formSubmissionChart=new Chart(ctx).Line(chartData,options);}else{Mautic.formSubmissionChart.destroy();Mautic.formSubmissionChart=new Chart(ctx).Line(chartData,options);}};Mautic.updateSubmissionChart=function(element,amount,unit){var element=mQuery(element);var wrapper=element.closest('ul');var button=mQuery('#time-scopes .button-label');var formId=Mautic.getFormId();wrapper.find('a').removeClass('bg-primary');element.addClass('bg-primary');button.text(element.text());var query="action=form:updateSubmissionChart&amount="+amount+"&unit="+unit+"&formId="+formId;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){Mautic.renderSubmissionChart(response.stats);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.leadOnLoad=function(container){Mousetrap.reset();Mousetrap.bind('shift+l',function(e){mQuery('#menu_lead_parent_child > li:first > a').click();});Mousetrap.bind('a',function(e){if(mQuery('#lead-quick-add').length){mQuery('#lead-quick-add').modal();}else if(mQuery('#addNoteButton').length){mQuery('#addNoteButton').click();}});Mousetrap.bind('t',function(e){mQuery('#table-view').click();});Mousetrap.bind('c',function(e){mQuery('#card-view').click();});Mousetrap.bind('n',function(e){mQuery('#new-lead').click();});Mousetrap.bind('mod+enter',function(e){if(mQuery('#leadnote_buttons_save').length){mQuery('#leadnote_buttons_save').click();}else if(mQuery('#save-quick-add').length){mQuery('#save-quick-add').click();}});Mousetrap.stopCallback=function(e,element,combo){if(element.id=='leadnote_text'&&combo!='mod+enter'){return true;}
if((' '+element.className+' ').indexOf(' mousetrap ')>-1){return false;}
return element.tagName=='INPUT'||element.tagName=='SELECT'||element.tagName=='TEXTAREA'||(element.contentEditable&&element.contentEditable=='true');};if(mQuery(container+' form[name="lead"]').length){Mautic.activateLeadOwnerTypeahead('lead_owner_lookup');mQuery("*[data-toggle='field-lookup']").each(function(index){var target=mQuery(this).attr('data-target');var field=mQuery(this).attr('id');var options=mQuery(this).attr('data-options');Mautic.activateLeadFieldTypeahead(field,target,options);});Mautic.updateLeadFieldProperties(mQuery('#leadfield_type').val());}
var timelineForm=mQuery(container+' #timeline-filters');if(timelineForm.length){timelineForm.on('change',function(){timelineForm.submit();}).on('keyup',function(){timelineForm.delay(200).submit();}).on('submit',function(e){e.preventDefault();Mautic.refreshLeadTimeline(timelineForm);});}
var noteForm=mQuery(container+' #note-filters');if(noteForm.length){noteForm.on('change',function(){noteForm.submit();}).on('keyup',function(){noteForm.delay(200).submit();}).on('submit',function(e){e.preventDefault();Mautic.refreshLeadNotes(noteForm);});}
if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','lead.lead');}
if(mQuery(container+' #notes-container').length){Mautic.activateSearchAutocomplete('NoteFilter','lead.note');}
if(mQuery('shuffle-grid').length){var grid=mQuery("#shuffle-grid");grid.shuffle({itemSelector:".shuffle"});mQuery("html").on("fa.sidebar.minimize",function(){grid.shuffle("update");}).on("fa.sidebar.maximize",function(){grid.shuffle("update");});}
if(typeof Mautic.leadEngagementChart==='undefined'){Mautic.renderEngagementChart();}};Mautic.leadOnUnload=function(id){if(id==='#app-content'){delete Mautic.leadEngagementChart;}};Mautic.getLeadId=function(){return mQuery('input#leadId').val();}
Mautic.activateLeadFieldTypeahead=function(field,target,options){if(options){var taMinLength=0;var keys=values=[];options=options.split('||');if(options.length==2){keys=options[0].split('|');values=options[1].split('|');}else{values=options[0].split('|');}
var substringMatcher=function(strs,strKeys){return function findMatches(q,cb){var matches,substringRegex;matches=[];substrRegex=new RegExp(q,'i');mQuery.each(strs,function(i,str){if(substrRegex.test(str)){if(strKeys.length&&typeof strKeys[i]!='undefined'){matches.push({value:str,id:strKeys[i]});}else{matches.push({value:str});}}});cb(matches);};};var source=substringMatcher(values,keys);}else{var taMinLength=2;this[field]=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace('value'),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mauticAjaxUrl+"?action=lead:fieldList&field="+target},remote:{url:mauticAjaxUrl+"?action=lead:fieldList&field="+target+"&filter=%QUERY"},dupDetector:function(remoteMatch,localMatch){return(remoteMatch.value==localMatch.value);},ttl:1800000,limit:5});this[field].initialize();var source=this[field].ttAdapter();}
mQuery('#'+field).typeahead({hint:true,highlight:true,minLength:taMinLength},{name:field,displayKey:'value',source:source}).on('typeahead:selected',function(event,datum){if(mQuery("#"+field+"_id").length&&datum["id"]){mQuery("#"+field+"_id").val(datum["id"]);}}).on('typeahead:autocompleted',function(event,datum){if(mQuery("#"+field+"_id").length&&datum["id"]){mQuery("#"+field+"_id").val(datum["id"]);}}).on('keypress',function(event){if((event.keyCode||event.which)==13){mQuery('#'+field).typeahead('close');}});};Mautic.activateLeadOwnerTypeahead=function(el){var owners=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace('label'),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mauticAjaxUrl+"?action=lead:userList"},remote:{url:mauticAjaxUrl+"?action=lead:userList&filter=%QUERY"},dupDetector:function(remoteMatch,localMatch){return(remoteMatch.label==localMatch.label);},ttl:1800000,limit:5});owners.initialize();mQuery("#"+el).typeahead({hint:true,highlight:true,minLength:2},{name:'lead_owners',displayKey:'label',source:owners.ttAdapter()}).on('typeahead:selected',function(event,datum){if(mQuery("#lead_owner").length){mQuery("#lead_owner").val(datum["value"]);}}).on('typeahead:autocompleted',function(event,datum){if(mQuery("#lead_owner").length){mQuery("#lead_owner").val(datum["value"]);}}).on('focus',function(){mQuery(this).typeahead('open');});};Mautic.leadlistOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','lead.list');}
if(mQuery('#leadlist_filters_right').length){mQuery('#leadlist_filters_right .remove-selected').each(function(index,el){mQuery(el).on('click',function(){mQuery(this).closest('.panel').remove();if(!mQuery('#leadlist_filters_right li:not(.placeholder)').length){mQuery('#leadlist_filters_right li.placeholder').removeClass('hide');}else{mQuery('#leadlist_filters_right li.placeholder').addClass('hide');}});});}
mQuery("*[data-toggle='field-lookup']").each(function(index){var target=mQuery(this).attr('data-target');var options=mQuery(this).attr('data-options');var field=mQuery(this).attr('id');Mautic.activateLeadFieldTypeahead(field,target,options);});};Mautic.addLeadListFilter=function(elId){var filterId='#available_'+elId;var label=mQuery(filterId+' span.leadlist-filter-name').text();var numFilters=mQuery('#leadlist_filters_right > div').length;var li=mQuery("<div />").addClass("panel").appendTo(mQuery('#leadlist_filters_right'));var fieldType=mQuery(filterId).data('field-type');var container=mQuery('<div />').addClass('filter-container').appendTo(li);if(fieldType=='country'||fieldType=='timezone'){container.html(mQuery('#filter-'+fieldType+'-template').html());}else{container.html(mQuery('#filter-template').html());}
if(numFilters==0){mQuery(container).find(".panel-footer").addClass('hide');}
mQuery(container).find("a.remove-selected").on('click',function(){li.remove();});mQuery(container).find("div.field-name").html(label);mQuery(container).find("input[name='leadlist[filters][field][]']").val(elId);mQuery(container).find("input[name='leadlist[filters][type][]']").val(fieldType);var uniqid="id_"+Date.now();var filter=mQuery(container).find("input[name='leadlist[filters][filter][]']");filter.attr('id',uniqid);if(fieldType=='lookup'||fieldType=='select'){var fieldCallback=mQuery(filterId).data("field-callback");if(fieldCallback){var fieldOptions=mQuery(filterId).data("field-list");Mautic[fieldCallback](uniqid,elId,fieldOptions);}}else if(fieldType=='datetime'){filter.datetimepicker({format:'Y-m-d H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false});}else if(fieldType=='date'){filter.datetimepicker({timepicker:false,format:'Y-m-d',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false,closeOnDateSelect:true});}else if(fieldType=='time'){filter.datetimepicker({datepicker:false,format:'H:i',lazyInit:true,validateOnBlur:false,allowBlank:true,scrollInput:false});}else if(fieldType=='lookup_id'||fieldType=='boolean'){var oldFilter=mQuery(container).find("input[name='leadlist[filters][filter][]']");var newDisplay=oldFilter.clone();newDisplay.attr('id',uniqid);newDisplay.attr('name','leadlist[filters][display][]');var oldDisplay=mQuery(container).find("input[name='leadlist[filters][display][]']");var newFilter=oldDisplay.clone();newFilter.attr('id',uniqid+"_id");newFilter.attr('name','leadlist[filters][filter][]');oldFilter.replaceWith(newFilter);oldDisplay.replaceWith(newDisplay);var fieldCallback=mQuery(filterId).data("field-callback");if(fieldCallback){var fieldOptions=mQuery(filterId).data("field-list");Mautic[fieldCallback](uniqid,elId,fieldOptions);}}else{filter.attr('type',fieldType);}};Mautic.leadfieldOnLoad=function(container){var fixHelper=function(e,ui){ui.children().each(function(){mQuery(this).width(mQuery(this).width());});return ui;};if(mQuery(container+' .leadfield-list').length){mQuery(container+' .leadfield-list tbody').sortable({handle:'.fa-ellipsis-v',helper:fixHelper,stop:function(i){mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=lead:reorder",data:mQuery(container+' .leadfield-list tbody').sortable("serialize")});}});}};Mautic.updateLeadFieldProperties=function(selectedVal){if(mQuery('#field-templates .'+selectedVal).length){mQuery('#leadfield_properties').html(mQuery('#field-templates .'+selectedVal).html());mQuery("#leadfield_properties *[data-toggle='tooltip']").tooltip({html:true});}else{mQuery('#leadfield_properties').html('');}
if(selectedVal=='time'){mQuery('#leadfield_isListable').closest('.row').addClass('hide');}else{mQuery('#leadfield_isListable').closest('.row').removeClass('hide');}};Mautic.refreshLeadSocialProfile=function(network,leadId,event){Mautic.startIconSpinOnEvent(event);var query="action=lead:updateSocialProfile&network="+network+"&lead="+leadId;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){if(response.completeProfile){mQuery('#social-container').html(response.completeProfile);mQuery('#SocialCount').html(response.socialCount);}else{mQuery.each(response.profiles,function(index,value){if(mQuery('#'+index+'CompleteProfile').length){mQuery('#'+index+'CompleteProfile').html(value.newContent);}});}}
Mautic.stopIconSpinPostEvent();},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);Mautic.stopIconSpinPostEvent();}});};Mautic.clearLeadSocialProfile=function(network,leadId,event){Mautic.startIconSpinOnEvent(event);var query="action=lead:clearSocialProfile&network="+network+"&lead="+leadId;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){mQuery('.'+network+'-panelremove').click();if(response.completeProfile){mQuery('#social-container').html(response.completeProfile);}
mQuery('#SocialCount').html(response.socialCount);}
Mautic.stopIconSpinPostEvent();},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);Mautic.stopIconSpinPostEvent();}});};Mautic.refreshLeadTimeline=function(form){var formData=form.serialize()
mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:"action=lead:updateTimeline&"+formData,dataType:"json",success:function(response){if(response.success){mQuery('#timeline-container').html(response.timeline);mQuery('#HistoryCount').html(response.historyCount);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.refreshLeadNotes=function(form){Mautic.postForm(mQuery(form),function(response){response.target='#NoteList';mQuery('#NoteCount').html(response.noteCount);Mautic.processPageContent(response);});};Mautic.toggleLeadList=function(toggleId,leadId,listId){var toggleOn='fa-toggle-on text-success';var toggleOff='fa-toggle-off text-danger';var action=mQuery('#'+toggleId).hasClass('fa-toggle-on')?'remove':'add';var query="action=lead:toggleLeadList&leadId="+leadId+"&listId="+listId+"&listAction="+action;if(action=='remove'){mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}else{mQuery('#'+toggleId).removeClass(toggleOff).addClass(toggleOn);}
mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(!response.success){if(action=='remove'){mQuery('#'+toggleId).addClass(toggleOff).addClass(toggleOn);}else{mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}}},error:function(request,textStatus,errorThrown){if(action=='remove'){mQuery('#'+toggleId).addClass(toggleOff).addClass(toggleOn);}else{mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}}});};Mautic.toggleLeadCampaign=function(toggleId,leadId,campaignId){var toggleOn='fa-toggle-on text-success';var toggleOff='fa-toggle-off text-danger';var action=mQuery('#'+toggleId).hasClass('fa-toggle-on')?'remove':'add';var query="action=lead:toggleLeadCampaign&leadId="+leadId+"&campaignId="+campaignId+"&campaignAction="+action;if(action=='remove'){mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}else{mQuery('#'+toggleId).removeClass(toggleOff).addClass(toggleOn);}
mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(!response.success){if(action=='remove'){mQuery('#'+toggleId).addClass(toggleOff).addClass(toggleOn);}else{mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}}},error:function(request,textStatus,errorThrown){if(action=='remove'){mQuery('#'+toggleId).addClass(toggleOff).addClass(toggleOn);}else{mQuery('#'+toggleId).removeClass(toggleOn).addClass(toggleOff);}}});};Mautic.leadNoteOnLoad=function(container,response){if(response.noteHtml){var el='#LeadNote'+response.noteId;if(mQuery(el).length){mQuery(el).replaceWith(response.noteHtml);}else{mQuery('#LeadNotes').prepend(response.noteHtml);}
mQuery(el+" *[data-toggle='ajaxmodal']").off('click.ajaxmodal');mQuery(el+" *[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Mautic.ajaxifyModal(this,event);});mQuery(el+" a[data-toggle='ajax']").off('click.ajax');mQuery(el+" a[data-toggle='ajax']").on('click.ajax',function(event){event.preventDefault();return Mautic.ajaxifyLink(this,event);});}else if(response.deleteId&&mQuery('#LeadNote'+response.deleteId).length){mQuery('#LeadNote'+response.deleteId).remove();}
if(response.upNoteCount||response.noteCount||response.downNoteCount){if(response.upNoteCount||response.downNoteCount){var count=parseInt(mQuery('#NoteCount').html());count=(response.upNoteCount)?count+1:count-1;}else{var count=parseInt(response.noteCount);}
mQuery('#NoteCount').html(count);}};Mautic.renderEngagementChart=function(){if(!mQuery("#chart-engagement").length){return;}
var canvas=document.getElementById("chart-engagement");var chartData=mQuery.parseJSON(mQuery('#chart-engagement-data').text());Mautic.leadEngagementChart=new Chart(canvas.getContext("2d")).Line(chartData);};Mautic.showSocialMediaImageModal=function(imgSrc)
{mQuery('#socialImageModal img').attr('src',imgSrc);mQuery('#socialImageModal').modal('show');};;function copyFields()
{jQuery('#field_copy').parent().append(jQuery('#field_copy').clone());};Mautic.pageOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','page.page');}
if(mQuery(container+' .page-stat-charts').length){Mautic.renderPageViewsBarChart(container);Mautic.renderPageReturningVisitsPie();Mautic.renderPageTimePie();}};Mautic.pageUnLoad=function(){mQuery('.builder').remove();};Mautic.pageOnUnload=function(id){if(id==='#app-content'){delete Mautic.pageViewsBarChartObject;delete Mautic.pageReturningVisitsPie;delete Mautic.pageTimePie;}};Mautic.launchPageEditor=function(){var src=mQuery('#pageBuilderUrl').val();src+='?template='+mQuery('#page_template').val();var builder=mQuery("<iframe />",{css:{margin:"0",padding:"0",border:"none",width:"100%",height:"100%"},id:"builder-template-content"}).attr('src',src).appendTo('.builder-content').load(function(){var $this=mQuery(this);var contents=$this.contents();contents.find('.mautic-editable').droppable({iframeFix:true,drop:function(event,ui){var instance=mQuery(this).attr("id");var predrop=mQuery(ui.draggable).data('predrop');if(predrop){Mautic[predrop](event,ui,instance);}else{var token=mQuery(ui.draggable).data('token');if(token){Mautic.insertPageBuilderToken(instance,token);}}
mQuery(this).removeClass('over-droppable');},over:function(e,ui){mQuery(this).addClass('over-droppable');},out:function(e,ui){mQuery(this).removeClass('over-droppable');}});});mQuery('.builder').addClass('builder-active');mQuery('.builder').removeClass('hide');Mautic.pageEditorOnLoad('.builder-panel');};Mautic.getPageBuilderEditorInstances=function(){return document.getElementById('builder-template-content').contentWindow.CKEDITOR.instances;};Mautic.closePageEditor=function(){Mautic.stopIconSpinPostEvent();mQuery('.builder').addClass('hide');mQuery('#builder-template-content').contents().find('.mautic-editable').each(function(index){mQuery(this).blur();});setTimeout(function(){mQuery('#builder-template-content').contents().find('.mautic-editable').droppable('destroy');mQuery("*[data-token]").draggable('destroy');mQuery('#builder-template-content').remove();},3000);};Mautic.pageEditorOnLoad=function(container){mQuery(container+" *[data-token]").draggable({iframeFix:true,iframeId:'builder-template-content',helper:'clone',appendTo:'.builder',zIndex:8000,scroll:true,scrollSensitivity:100,scrollSpeed:100,cursorAt:{top:15,left:15}});};Mautic.renderPageViewsBarChart=function(container){if(!mQuery('#page-views-chart').length){return;}
chartData=mQuery.parseJSON(mQuery('#page-views-chart-data').text());if(typeof chartData.labels==="undefined"){return;}
var ctx=document.getElementById("page-views-chart").getContext("2d");var options={scaleShowGridLines:false,barShowStroke:false,barValueSpacing:1,showScale:false,tooltipFontSize:10,tooltipCaretSize:0}
if(typeof Mautic.pageViewsBarChartObject==='undefined'){Mautic.pageViewsBarChartObject=new Chart(ctx).Bar(chartData,options);}};Mautic.renderPageReturningVisitsPie=function(){if(typeof Mautic.pageReturningVisitsPie==='object'){return;}
var graphData=mQuery.parseJSON(mQuery('#returning-data').text());var options={responsive:false,tooltipFontSize:10};graphData=Mautic.emulateNoDataForPieChart(graphData);var ctx=document.getElementById("returning-rate").getContext("2d");Mautic.pageReturningVisitsPie=new Chart(ctx).Pie(graphData,options);};Mautic.renderPageTimePie=function(){if(typeof Mautic.pageTimePie==='object'){return;}
var element=mQuery('#time-rate');var options={responsive:false,tooltipFontSize:10,tooltipTemplate:"<%if (label){%><%}%><%= value %>x <%=label%>"};var timesOnSiteData=mQuery.parseJSON(mQuery('#times-on-site-data').text());timesOnSiteData=Mautic.emulateNoDataForPieChart(timesOnSiteData);var ctx=document.getElementById("time-rate").getContext("2d");Mautic.pageTimePie=new Chart(ctx).Pie(timesOnSiteData,options);};Mautic.showPageBuilderTokenExternalLinkModal=function(event,ui,editorId){var token=mQuery(ui.draggable).data('token');mQuery('#ExternalLinkModal input[name="editor"]').val(editorId);mQuery('#ExternalLinkModal input[name="token"]').val(token);mQuery('#ExternalLinkModal').appendTo('body');mQuery('#ExternalLinkModal').modal('show');};Mautic.insertPageBuilderTokenExternalUrl=function(){var editorId=mQuery('#ExternalLinkModal input[name="editor"]').val();var token=mQuery('#ExternalLinkModal input[name="token"]').val();var url=mQuery('#ExternalLinkModal input[name="link"]').val();token=token.replace("%url%",url);Mautic.insertPageBuilderToken(editorId,token);};Mautic.insertPageBuilderToken=function(editorId,token){var editor=Mautic.getPageBuilderEditorInstances();editor[editorId].insertText(token);mQuery('#ExternalLinkModal').modal('hide');mQuery('#ExternalLinkModal input[name="link"]').val('');};Mautic.togglePageContentMode=function(el){var builder=(mQuery(el).val()==='0')?false:true;if(builder){mQuery('#customHtmlContainer').addClass('hide');mQuery('#builderHtmlContainer').removeClass('hide');mQuery('#metaDescriptionContainer').removeClass('hide');}else{mQuery('#customHtmlContainer').removeClass('hide');mQuery('#builderHtmlContainer').addClass('hide');mQuery('#metaDescriptionContainer').addClass('hide');}};Mautic.getPageAbTestWinnerForm=function(abKey){if(abKey&&mQuery(abKey).val()&&mQuery(abKey).closest('.form-group').hasClass('has-error')){mQuery(abKey).closest('.form-group').removeClass('has-error');if(mQuery(abKey).next().hasClass('help-block')){mQuery(abKey).next().remove();}}
var labelSpinner=mQuery("label[for='page_variantSettings_winnerCriteria']");var spinner=mQuery('<i class="fa fa-fw fa-spinner fa-spin"></i>');labelSpinner.append(spinner);var pageId=mQuery('#page_sessionId').val();var query="action=page:getAbTestForm&abKey="+mQuery(abKey).val()+"&pageId="+pageId;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){if(mQuery('#page_variantSettings_properties').length){mQuery('#page_variantSettings_properties').replaceWith(response.html);}else{mQuery('#page_variantSettings').append(response.html);}
if(response.html!=''){Mautic.onPageLoad('#page_variantSettings_properties',response);}}
spinner.remove();},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);spinner.remove();}});};;Mautic.pointOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','point');}};Mautic.pointTriggerOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','point.trigger');}
if(mQuery('#triggerEvents')){mQuery('#triggerEvents').sortable({items:'.trigger-event-row',handle:'.reorder-handle',stop:function(i){mQuery.ajax({type:"POST",url:mauticAjaxUrl+"?action=point:reorderTriggerEvents",data:mQuery('#triggerEvents').sortable("serialize")+"&triggerId="+mQuery('#pointtrigger_sessionId').val()});}});mQuery('#triggerEvents .trigger-event-row').on('mouseover.triggerevents',function(){mQuery(this).find('.form-buttons').removeClass('hide');}).on('mouseout.triggerevents',function(){mQuery(this).find('.form-buttons').addClass('hide');});}};Mautic.pointTriggerEventOnLoad=function(container,response){if(response.eventHtml){var newHtml=response.eventHtml;var eventId='#triggerEvent_'+response.eventId;if(mQuery(eventId).length){mQuery(eventId).replaceWith(newHtml);var newField=false;}else{mQuery(newHtml).appendTo('#triggerEvents');var newField=true;}
mQuery(eventId+" *[data-toggle='tooltip']").tooltip({html:true});mQuery(eventId+" a[data-toggle='ajax']").click(function(event){event.preventDefault();return Mautic.ajaxifyLink(this,event);});mQuery(eventId+" a[data-toggle='ajaxmodal']").on('click.ajaxmodal',function(event){event.preventDefault();Mautic.ajaxifyModal(this,event);});mQuery('#triggerEvents .trigger-event-row').off(".triggerevents");mQuery('#triggerEvents .trigger-event-row').on('mouseover.triggerevents',function(){mQuery(this).find('.form-buttons').removeClass('hide');}).on('mouseout.triggerevents',function(){mQuery(this).find('.form-buttons').addClass('hide');});if(!mQuery('#events-panel').hasClass('in')){mQuery('a[href="#events-panel"]').trigger('click');}
if(mQuery('#triggerEventPlaceholder').length){mQuery('#triggerEventPlaceholder').remove();}}};Mautic.getPointActionPropertiesForm=function(actionType){var labelSpinner=mQuery("label[for='point_type']");var spinner=mQuery('<i class="fa fa-fw fa-spinner fa-spin"></i>');labelSpinner.append(spinner);var query="action=point:getActionForm&actionType="+actionType;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){mQuery('#pointActionProperties').html(response.html);Mautic.onPageLoad('#pointActionProperties',response);}
spinner.remove();},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);spinner.remove();}});};;Mautic.reportOnLoad=function(container){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','report');}
if(mQuery('div[id=report_filters]').length){mQuery('div[id=report_filters]').data('index',mQuery('#report_filters > div').length);}
Mautic.initGraphs();};Mautic.reportOnUnload=function(id){if(id==='#app-content'){delete Mautic.reportGraphs;}};Mautic.addFilterRow=function(){var prototypeHolder=mQuery('div[id=report_filters]');var index=prototypeHolder.data('index');var prototype=prototypeHolder.data('prototype');var output=prototype.replace(/__name__/g,index);prototypeHolder.data('index',index+1);prototypeHolder.append(output);};Mautic.removeFilterRow=function(container){mQuery('#'+container).remove();};Mautic.updateColumnList=function(el){var el=mQuery(el)
var form=el.closest('form');var data={};data[el.attr('name')]=el.val();mQuery.ajax({url:mauticAjaxUrl+"?action=report:getForm",type:'post',data:data,success:function(response){if(response.newContent){var html=response.newContent;var columnElement=mQuery('#report_columns');columnElement.children().replaceWith(mQuery(html).find('#report_columns').children());columnElement.trigger('chosen:updated');mQuery('#report_filters').find('div').remove().end();mQuery('#report_filters').replaceWith(mQuery(html).find('#report_filters'));}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});};Mautic.checkReportCondition=function(selector){var option=mQuery('#'+selector+' option:selected').val();var valueInput=selector.replace('condition','value');if(option=='empty'||option=='notEmpty'){mQuery('#'+valueInput).prop('disabled',true);}else{mQuery('#'+valueInput).prop('disabled',false);}};Mautic.initGraphs=function(){Mautic.reportGraphs={};var graphs=mQuery('canvas.graph');mQuery.each(graphs,function(i,graph){var mGraph=mQuery(graph);if(mGraph.hasClass('graph-line')){var id=mGraph.attr('id');if(typeof Mautic.reportGraphs[id]==='undefined'){var graphData=mQuery.parseJSON(mQuery('#'+id+'-data').text());Mautic.reportGraphs[id]=Mautic.renderLineGraph(graph.getContext("2d"),graphData);}}
if(mGraph.hasClass('graph-pie')){var id=mGraph.attr('id');if(typeof Mautic.reportGraphs[id]==='undefined'){var graphData=mQuery.parseJSON(mQuery('#'+id+'-data').text());Mautic.reportGraphs[id]=Mautic.renderPieGraph(graph.getContext("2d"),graphData);}}});}
Mautic.updateReportGraph=function(element,options){var id=options.graphName.replace(/\./g,'-');var element=mQuery(element);var wrapper=element.closest('ul');var button=mQuery('#time-scopes .button-label');var reportId=Mautic.getReportId();wrapper.find('a').removeClass('bg-primary');element.addClass('bg-primary');button.text(element.text());var query="action=report:updateGraph&reportId="+reportId+'&'+mQuery.param(options);mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(response.success){Mautic.reportGraphs[id].destroy();delete Mautic.reportGraphs[id];var mGraph=mQuery('#'+id);if(typeof response.graph.line!='undefined'){Mautic.reportGraphs[id]=Mautic.renderLineGraph(mGraph.get(0).getContext("2d"),response.graph.line[0]);}}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);}});}
Mautic.renderLineGraph=function(canvas,chartData){var options={};return new Chart(canvas).Line(chartData,options);};Mautic.renderPieGraph=function(canvas,chartData){var options={responsive:false,tooltipFontSize:10,tooltipTemplate:"<%if (label){%><%}%><%= value %>x <%=label%>"};Mautic.pageTimePie=new Chart(canvas).Pie(chartData,options);}
Mautic.getReportId=function(){return mQuery('#reportId').val();};Mautic.userOnLoad=function(container){if(mQuery(container+' form[name="user"]').length){if(mQuery('#user_position').length){var positions=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace('value'),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:mauticAjaxUrl+"?action=user:positionList"},remote:{url:mauticAjaxUrl+"?action=user:positionList&filter=%QUERY"},dupDetector:function(remoteMatch,localMatch){return(remoteMatch.label==localMatch.label);},ttl:1800000,limit:5});positions.initialize();mQuery("#user_position").typeahead({hint:true,highlight:true,minLength:2},{name:'user_position',displayKey:'value',source:positions.ttAdapter()});}}else{if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','user.user');}}};Mautic.roleOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','user.role');}
if(response&&response.permissionList){MauticVars.permissionList=response.permissionList;}};Mautic.togglePermissionVisibility=function(){setTimeout(function(){if(mQuery('#role_isAdmin_0').prop('checked')){mQuery('#permissions-container').removeClass('hide');}else{mQuery('#permissions-container').addClass('hide');}},10);};Mautic.onPermissionChange=function(changedPermission,bundle){var granted=0;if(mQuery(changedPermission).prop('checked')){if(mQuery(changedPermission).val()=='full'){mQuery(changedPermission).closest('.btn-group').find("label input:checkbox:checked").map(function(){if(mQuery(this).val()!='full'){mQuery(this).prop('checked',false);mQuery(this).parent().toggleClass('active');}})}else{mQuery(changedPermission).closest('.btn-group').find("label input:checkbox:checked").map(function(){if(mQuery(this).val()=='full'){granted=granted-1;mQuery(this).prop('checked',false);mQuery(this).parent().toggleClass('active');}})}}
if(mQuery('.'+bundle+'_granted').length){var granted=0;var levelPerms=MauticVars.permissionList[bundle];mQuery.each(levelPerms,function(level,perms){mQuery.each(perms,function(index,perm){var isChecked=mQuery('input[data-permission="'+bundle+':'+level+':'+perm+'"]').prop('checked');if(perm=='full'){if(isChecked){if(perms.length===1){granted++;}else{granted+=perms.length-1;}}}else if(isChecked){granted++;}});});mQuery('.'+bundle+'_granted').html(granted);console.log(mQuery('.'+bundle+'_granted'));}};