/*! grapesjs-preset-mautic - 1.0.330 */
!function(t,e){'object'==typeof exports&&'object'==typeof module?module.exports=e():'function'==typeof define&&define.amd?define([],e):'object'==typeof exports?exports["grapesjs-preset-mautic"]=e():t["grapesjs-preset-mautic"]=e()}(window,(function(){return function(t){var e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(t,'__esModule',{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&'object'==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,'default',{enumerable:!0,value:t}),2&e&&'string'!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,'a',e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=3)}([function(t,e){t.exports=function(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function o(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}},function(t,e,o){"use strict";o.r(e);var n=o(0),i=o.n(n);function a(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function r(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?a(Object(o),!0).forEach((function(e){i()(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var s=function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var e=t.DomComponents,o=e.getType('default'),n=o.model;e.addType('dynamic-content',{model:n.extend({defaults:r({},n.prototype.defaults,{name:'Dynamic Content',draggable:'[data-gjs-type=cell]',droppable:!1,editable:!1,stylable:!1,propagate:['droppable','editable'],attributes:{'data-gjs-type':'dynamic-content','data-slot':'dynamicContent'}}),init:function(){var t=this.get('toolbar'),e='toolbar-dynamic-content';t.filter((function(t){return t.id===e})).length||t.unshift({id:e,command:'preset-mautic:dynamic-content',label:'<div class="fa fa-tag"></div>'})}},{isComponent:function(t){if(t.getAttribute&&'dynamicContent'==t.getAttribute('data-slot'))return{type:'dynamic-content'}}}),view:o.view.extend({attributes:{style:'pointer-events: all; display: table; width: 100%;user-select: none;'},events:{dblclick:'onActive'},onActive:function(){var t=this.model;this.em.get('Commands').run('preset-mautic:dynamic-content',{target:t})}})}),e.addType('dynamic-content-mjml',{model:n.extend({defaults:r({},n.prototype.defaults,{name:'Dynamic Content',draggable:'[data-gjs-type=mj-column], [data-gjs-type=mj-hero]',droppable:!1,editable:!1,stylable:!1,propagate:['droppable','editable'],attributes:{'data-gjs-type':'dynamic-content','data-slot':'dynamicContent'}}),init:function(){var t=this.get('toolbar'),e='toolbar-dynamic-content';t.filter((function(t){return t.id===e})).length||t.unshift({id:e,command:'preset-mautic:dynamic-content',label:'<div class="fa fa-tag"></div>'})}},{isComponent:function(t){if(t.getAttribute&&'dynamicContent'==t.getAttribute('data-slot'))return{type:'dynamic-content'}}}),view:o.view.extend({attributes:{style:'pointer-events: all; display: table; width: 100%;user-select: none;'},events:{dblclick:'onActive'},onActive:function(){var t=this.model;this.em.get('Commands').run('preset-mautic:dynamic-content',{target:t})}})})},c=o(1),l=o.n(c),d=o(2),u=o.n(d),p=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l()(this,t),this.editor=e,this.opts=o,this.codeEditor=this.buildCodeEditor(),this.codePopup=this.buildCodePopup()}return u()(t,[{key:"buildCodeEditor",value:function(){var t=this.editor.CodeManager.getViewer('CodeMirror').clone();return t.set({codeName:'htmlmixed',readOnly:!1,theme:'hopscotch',autoBeautify:!0,autoCloseTags:!0,autoCloseBrackets:!0,lineWrapping:!0,styleActiveLine:!0,smartIndent:!0,indentWithTabs:!0}),t}},{key:"buildCodePopup",value:function(){var t=this.editor.getConfig(),e=document.createElement('div'),o=document.createElement('button'),n=document.createElement('button'),i=document.createElement('textarea');return o.innerHTML=this.opts.sourceEditBtnLabel,o.className=t.stylePrefix+'btn-prim '+t.stylePrefix+'btn-code-edit',o.onclick=this.updateCode.bind(this),n.innerHTML=this.opts.sourceCancelBtnLabel,n.className=t.stylePrefix+'btn-prim '+t.stylePrefix+'btn-code-cancel',n.onclick=this.cancelCode.bind(this),e.appendChild(i),e.appendChild(o),e.appendChild(n),this.codeEditor.init(i),e}},{key:"showCodePopup",value:function(){this.updateEditorContents(),this.codeEditor.editor.refresh(),this.editor.Modal.setContent(''),this.editor.Modal.setContent(this.codePopup),this.editor.Modal.setTitle(this.opts.sourceEditModalTitle),this.editor.Modal.open()}},{key:"updateCode",value:function(){var t=this.codeEditor.editor.getValue(),e=this.getEditorContent();try{this.editor.DomComponents.getWrapper().set('content',''),this.editor.setComponents(t.trim()),this.editor.Modal.close()}catch(t){window.alert('Template error, you should fix your code before save! \n'+t.message),this.editor.DomComponents.getWrapper().set('content',''),this.editor.setComponents(e.trim())}}},{key:"cancelCode",value:function(){this.editor.Modal.close()}},{key:"updateEditorContents",value:function(){this.codeEditor.setContent(this.getEditorContent())}},{key:"getEditorContent",value:function(){return this.editor.getConfig().plugins.includes('grapesjs-mjml')?this.editor.getHtml():this.editor.getHtml()+'<style>'+this.editor.getCss({avoidProtected:!0})+'</style>'}}]),t}(),m=function(){function t(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l()(this,t),this.editor=e,this.opts=o,this.codePopup=this.buildCodePopup()}return u()(t,[{key:"buildCodePopup",value:function(){var t=this.editor.getConfig(),e=document.createElement('div'),o=document.createElement('div');o.setAttribute("id","dynamic-content-popup");var n=document.createElement('button');return n.innerHTML=this.opts.dynamicContentBtnLabel,n.className=t.stylePrefix+'btn-prim '+t.stylePrefix+'btn-dynamic-content',n.onclick=this.updateCode.bind(this),e.appendChild(o),e.appendChild(n),e}},{key:"showCodePopup",value:function(t){this.updatePopupContents(t),this.editor.Modal.setContent(''),this.editor.Modal.setContent(this.codePopup),this.editor.Modal.setTitle(this.opts.dynamicContentModalTitle),this.editor.Modal.open()}},{key:"updateCode",value:function(){this.editor.Modal.close()}},{key:"updatePopupContents",value:function(t){var e=this,o=this.codePopup.querySelector('#dynamic-content-popup'),n=t.getAttributes(),i=mQuery('#emailform_dynamicContent_'+n['data-param-dec-id']);i.find('textarea.editor').each((function(){var t=e.opts.dynamicContentFroalaButtons,o={toolbarButtons:t,toolbarButtonsMD:t,toolbarButtonsSM:t,toolbarButtonsXS:t,toolbarSticky:!1,linkList:[],imageEditButtons:['imageReplace','imageAlign','imageRemove','imageAlt','imageSize','|','imageLink','linkOpen','linkEdit','linkRemove']};mQuery(this).froalaEditor('destroy'),mQuery(this).froalaEditor(mQuery.extend({},Mautic.basicFroalaOptions,o))})),i.removeClass('fade'),i.find('.tab-pane:first').find('.remove-item').hide(),mQuery(o).empty().append(i.detach())}}]),t}(),g=function(t){var e,o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.Commands;i.add('preset-mautic:code-edit',{run:function(t,o){arguments.length>2&&void 0!==arguments[2]&&arguments[2];e||(e=new p(t,n)),o&&o.set('active',0),Mautic.grapesConvertDynamicContentSlotsToTokens(t),e.showCodePopup()},stop:function(t){Mautic.grapesConvertDynamicContentTokenToSlot(t)}}),i.add('preset-mautic:dynamic-content',{run:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.target,r=a||t.getSelected();o||(o=new m(t,n)),o.showCodePopup(r),Mautic.grapesConvertDynamicContentSlotsToTokens(t)},stop:function(t){Mautic.grapesConvertDynamicContentTokenToSlot(t)}})},f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.$,n=t.Panels;if(e.sourceEdit&&n.addButton('options',[{id:'code-edit',className:'fa fa-edit',command:'preset-mautic:code-edit',attributes:{title:e.sourceEditModalTitle}}]),!e.showImportButton){var i=n.getButton('options','mjml-import'),a=n.getButton('options','gjs-open-import-template'),r=n.getButton('options','gjs-open-import-webpage');null!==i&&n.removeButton('options','mjml-import'),null!==a&&n.removeButton('options','gjs-open-import-template'),null!==r&&n.removeButton('options','gjs-open-import-webpage')}var s=n.getButton('options','undo'),c=n.getButton('options','redo');null!==s&&(n.removeButton('options','undo'),n.addButton('commands',[{id:'undo',className:'fa fa-undo',attributes:{title:'Undo'},command:function(){t.runCommand('core:undo')}}])),null!==c&&(n.removeButton('options','redo'),n.addButton('commands',[{id:'redo',className:'fa fa-repeat',attributes:{title:'Redo'},command:function(){t.runCommand('core:redo')}}]));var l=n.getButton('options','preview');null!==l&&n.removeButton('options','preview');var d=n.getButton('options','canvas-clear');null!==d&&n.removeButton('options','canvas-clear');var u=n.getButton('options','gjs-toggle-images');null!==u&&n.removeButton('options','gjs-toggle-images'),t.on('load',(function(){if(!e.showLayersManager){var i=n.getButton('views','open-layers');null!==i&&i.set('attributes',{style:'display:none;'})}var a=n.getButton('options','sw-visibility');a&&a.set('active',1);var r=n.getButton('views','open-tm');r&&r.set('active',1);var s=n.getButton('views','open-sm');s&&s.set('active',1),n.removeButton("views","open-tm");var c=o("<div class=\"gjs-sm-sector no-select\"><div class=\"gjs-sm-title\"><span class=\"icon-settings fa fa-cog\"></span> Settings</div><div class=\"gjs-sm-properties\" style=\"display: none;\"></div></div>"),l=c.find('.gjs-sm-properties');l.append(o('.gjs-trt-traits')),o('.gjs-sm-sectors').before(c),c.find('.gjs-sm-title').on('click',(function(){var t=l.get(0).style,e='none'===t.display;t.display=e?'block':'none'})),l.get(0).style.display='block';var d=t.Panels.getButton('views','open-blocks');d&&d.set('active',1)}))},y=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.BlockManager,n=t.getConfig(),i=o.getAll();n.plugins.includes('grapesjs-mjml')?o.add('dynamic-content-mjml',{label:e.dynamicContentBlockLabel,activate:!0,select:!0,attributes:{class:'fa fa-tag'},content:{type:'dynamic-content-mjml',content:'{dynamiccontent="Dynamic Content"}',style:{padding:'10px'},activeOnRender:1}}):n.plugins.includes('gjs-preset-newsletter')&&o.add('dynamic-content',{label:e.dynamicContentBlockLabel,activate:!0,select:!0,attributes:{class:'fa fa-tag'},content:{type:'dynamic-content',content:'{dynamiccontent="Dynamic Content"}',style:{padding:'10px'},activeOnRender:1}}),void 0!==o.get('mj-hero')&&o.get('mj-hero').set({attributes:{class:'gjs-fonts gjs-f-hero'}}),void 0!==o.get('mj-wrapper')&&o.remove('mj-wrapper'),i.forEach((function(t){t.set({category:e.categoryBlockLabel})})),void 0!==o.get('mj-1-column')&&o.get('mj-1-column').set({category:e.categorySectionLabel}),void 0!==o.get('mj-2-columns')&&o.get('mj-2-columns').set({category:e.categorySectionLabel}),void 0!==o.get('mj-3-columns')&&o.get('mj-3-columns').set({category:e.categorySectionLabel}),void 0!==o.get('sect100')&&o.get('sect100').set({category:e.categorySectionLabel}),void 0!==o.get('sect50')&&o.get('sect50').set({category:e.categorySectionLabel}),void 0!==o.get('sect30')&&o.get('sect30').set({category:e.categorySectionLabel}),void 0!==o.get('sect37')&&o.get('sect37').set({category:e.categorySectionLabel}),void 0!==o.get('column1')&&o.get('column1').set({category:e.categorySectionLabel}),void 0!==o.get('column2')&&o.get('column2').set({category:e.categorySectionLabel}),void 0!==o.get('column3')&&o.get('column3').set({category:e.categorySectionLabel}),void 0!==o.get('column3-7')&&o.get('column3-7').set({category:e.categorySectionLabel})};function b(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function v(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?b(Object(o),!0).forEach((function(e){i()(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):b(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}e.default=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=mQuery,n=t.AssetManager,i=v({sourceEdit:1,sourceEditBtnLabel:'Edit',sourceCancelBtnLabel:'Cancel',sourceEditModalTitle:'Edit code',deleteAssetConfirmText:'Are you sure?',showLayersManager:0,showImportButton:0,replaceRteWithFroala:!0,categorySectionLabel:'Sections',categoryBlockLabel:'Blocks',dynamicContentBlockLabel:'Dynamic Content',dynamicContentBtnLabel:'Save',dynamicContentModalTitle:'Edit Dynamic Content',dynamicContentFroalaButtons:['undo','redo','|','bold','italic','underline','fontSize','color','align','formatOL','formatUL','quote','clearFormatting','token','insertLink','insertImage','html']},e);if(n.addType('image',{view:{onRemove:function(t){t.stopImmediatePropagation();var e=this.model;confirm(i.deleteAssetConfirmText)&&e.collection.remove(e)}}}),i.replaceRteWithFroala&&void 0!==o.FroalaEditor){var a=t.RichTextEditor.getToolbarEl();[].forEach.call(a.children,(function(t){t.style.display='none'})),t.setCustomRte({enable:function(e,n){return n=o(e).froalaEditor({enter:o.FroalaEditor.ENTER_BR,pastePlain:!0,htmlAllowedTags:['a','abbr','address','area','article','aside','audio','b','base','bdi','bdo','blockquote','br','button','canvas','caption','cite','code','col','colgroup','datalist','dd','del','details','dfn','dialog','div','dl','dt','em','embed','fieldset','figcaption','figure','footer','form','h1','h2','h3','h4','h5','h6','header','hgroup','hr','i','iframe','img','input','ins','kbd','keygen','label','legend','li','link','main','map','mark','menu','menuitem','meter','nav','noscript','object','ol','optgroup','option','output','p','param','pre','progress','queue','rp','rt','ruby','s','samp','script','style','section','select','small','source','span','strike','strong','sub','summary','sup','table','tbody','td','textarea','tfoot','th','thead','time','title','tr','track','u','ul','var','video','wbr','center'],htmlAllowedAttrs:['data-atwho-at-query','data-section','data-section-wrapper','accept','accept-charset','accesskey','action','align','allowfullscreen','alt','async','autocomplete','autofocus','autoplay','autosave','background','bgcolor','border','charset','cellpadding','cellspacing','checked','cite','class','color','cols','colspan','content','contenteditable','contextmenu','controls','coords','data','data-.*','datetime','default','defer','dir','dirname','disabled','download','draggable','dropzone','enctype','for','form','formaction','frameborder','headers','height','hidden','high','href','hreflang','http-equiv','icon','id','ismap','itemprop','keytype','kind','label','lang','language','list','loop','low','max','maxlength','media','method','min','mozallowfullscreen','multiple','name','novalidate','open','optimum','pattern','ping','placeholder','poster','preload','pubdate','radiogroup','readonly','rel','required','reversed','rows','rowspan','sandbox','scope','scoped','scrolling','seamless','selected','shape','size','sizes','span','src','srcdoc','srclang','srcset','start','step','summary','spellcheck','style','tabindex','target','title','type','translate','usemap','value','valign','webkitallowfullscreen','width','wrap'],toolbarButtons:['bold','italic','underline','strikeThrough','quote','clearFormatting','-','formatOL','formatUL','indent','outdent','token','insertLink'],toolbarContainer:t.RichTextEditor.getToolbarEl(),linkEditButtons:['linkOpen','linkRemove']}),o(e).on('froalaEditor.popups.show.link.edit',(function(t,n){var i=o(e).froalaEditor('link.get'),a=o(e).froalaEditor('popups.get','link.edit');if(void 0!==i){var r=i.getBoundingClientRect().top,s=o(i).outerHeight();a.css('top',parseInt(r)+parseInt(s)+35)}})),n},disable:function(t,e){o(t).off('froalaEditor.popups.show.link.edit'),o(t).froalaEditor('destroy')}})}s(t,i),g(t,i),f(t,i),y(t,i)}}])}));
//# sourceMappingURL=grapesjs-preset-mautic.min.js.map